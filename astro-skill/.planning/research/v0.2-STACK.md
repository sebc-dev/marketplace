# Technology Stack: Cloudflare MCP Documentation Integration

**Project:** astro-skill v0.2 (Cloudflare MCP integration into existing Claude Code Skill)
**Researched:** 2026-02-03
**Mode:** Ecosystem (Stack dimension -- MCP tool API investigation)
**Overall Confidence:** MEDIUM (WebSearch/WebFetch unavailable; findings based on training data + project context)

---

## Executive Summary

The `mcp__cloudflare__search_cloudflare_documentation` MCP tool is part of Cloudflare's official MCP server (`@cloudflare/mcp-server-cloudflare`). It provides semantic search across the entire Cloudflare developer documentation corpus (developers.cloudflare.com). The tool accepts a text query and returns relevant documentation excerpts covering all Cloudflare products and services.

The integration pattern should mirror the existing `mcp__astro_doc__search_astro_docs` pattern: the skill provides the "savoir-faire" layer (when to use what, what to avoid, why) and the MCP provides the "raw official documentation" layer (API signatures, configuration reference, product details).

**Critical finding:** Unlike the Astro MCP which covers a single framework, the Cloudflare MCP covers a vast product surface (Workers, KV, D1, R2, Pages, Durable Objects, Queues, AI, Images, DNS, WAF, Zero Trust, and 50+ more products). The skill must be prescriptive about WHICH Cloudflare products to query for, and provide query templates that yield relevant results for the Astro-on-Cloudflare context.

---

## MCP Tool Specification

### Tool Identity

| Property | Value | Confidence |
|----------|-------|------------|
| Full qualified name | `mcp__cloudflare__search_cloudflare_documentation` | HIGH -- from PROJECT.md, matches MCP naming convention `mcp__{server}__{tool}` |
| MCP server | `cloudflare` (server name in Claude Code MCP config) | HIGH -- inferred from tool name prefix |
| Package | `@cloudflare/mcp-server-cloudflare` | MEDIUM -- from training data, not verified against current npm registry |
| Source repo | `github.com/cloudflare/mcp-server-cloudflare` | MEDIUM -- from training data |

### Tool Signature

```
mcp__cloudflare__search_cloudflare_documentation({ query: string })
```

| Parameter | Type | Required | Description | Confidence |
|-----------|------|----------|-------------|------------|
| `query` | `string` | Yes | Natural language search query against Cloudflare docs | MEDIUM |

**Return format:** The tool returns documentation excerpts from developers.cloudflare.com. Results include:
- Relevant text passages from matching documentation pages
- Enough context to answer the query directly
- Coverage across all Cloudflare developer documentation

**Confidence on return format: LOW** -- I have not been able to verify the exact return schema (WebFetch was unavailable). The Astro MCP tool (`search_astro_docs`) returns similar structured text excerpts, and Cloudflare's tool likely follows the same pattern, but this needs empirical validation.

### Comparison with Existing Astro MCP Tool

| Aspect | `mcp__astro_doc__search_astro_docs` | `mcp__cloudflare__search_cloudflare_documentation` |
|--------|------|------|
| **Server name** | `astro_doc` | `cloudflare` |
| **Tool name** | `search_astro_docs` | `search_cloudflare_documentation` |
| **Scope** | Single framework (Astro) | Entire Cloudflare platform (50+ products) |
| **Documentation source** | docs.astro.build | developers.cloudflare.com |
| **Query specificity needed** | Low (small corpus) | HIGH (massive corpus, must be specific) |
| **Parameter** | `query: string` | `query: string` |
| **Integration in SKILL.md** | Single "## MCP Integration" section | Needs its own subsection under MCP Integration |

**Key difference:** The Astro MCP searches a focused corpus (~one framework). The Cloudflare MCP searches a massive corpus (Workers, KV, D1, R2, Pages, Durable Objects, Queues, AI, Images, DNS, WAF, etc.). This means:

1. **Vague queries will return irrelevant results.** Querying "how to configure" could return results about configuring DNS, WAF rules, or Zero Trust policies -- none relevant to Astro development.
2. **The skill must provide query templates** that scope results to the Cloudflare products relevant to Astro-on-Cloudflare development.
3. **The skill must teach Claude WHEN to use which MCP** -- Astro MCP for framework questions, Cloudflare MCP for platform questions.

---

## Cloudflare Product Coverage

### Products Relevant to Astro-on-Cloudflare Development

These are the Cloudflare products that the skill should direct MCP queries toward:

| Product | Relevance to Astro | Example MCP Queries | Confidence |
|---------|-------------------|---------------------|------------|
| **Workers** | Runtime for Astro SSR, API routes, middleware | "Workers compatibility flags", "Workers CPU time limits" | HIGH |
| **Workers Static Assets** | Serves Astro static files alongside Worker | "Workers static assets configuration", "run_worker_first routing" | HIGH |
| **KV** | Session storage, caching, key-value data | "KV API put get delete", "KV list keys prefix" | HIGH |
| **D1** | SQL database for structured data | "D1 prepare bind query", "D1 batch statements" | HIGH |
| **R2** | Object storage for files, images, media | "R2 put get object", "R2 presigned URLs" | HIGH |
| **Durable Objects** | Stateful coordination, WebSockets, counters | "Durable Objects alarm handler", "DO WebSocket hibernation" | MEDIUM |
| **Queues** | Async task processing, background jobs | "Queues producer consumer configuration" | MEDIUM |
| **Pages** | Legacy deploy target (deprecated for new projects) | "Pages build configuration", "Pages functions" | MEDIUM |
| **Hyperdrive** | PostgreSQL connection pooling | "Hyperdrive configuration connect" | MEDIUM |
| **Workers AI** | AI inference at the edge | "Workers AI model inference binding" | LOW (niche) |
| **Images** | Image resizing/transformation service | "Cloudflare Image Resizing workers", "image transform" | MEDIUM |

### Products NOT Relevant to Astro Development (Noise)

These exist in the same documentation corpus but should NOT be the target of MCP queries from the skill:

| Product Category | Examples | Why Irrelevant |
|------------------|----------|---------------|
| DNS/Domain management | DNS records, DNSSEC, registrar | Infrastructure, not application development |
| CDN/Caching configuration | Cache Rules, Page Rules, Tiered Cache | Dashboard config, not code-level |
| Security/WAF | WAF rules, Bot Management, DDoS | Security team concerns, not Astro dev |
| Zero Trust/Access | Tunnel, Access policies, WARP | Network-level, not application-level |
| Email routing | Email Workers, routing rules | Separate product domain |
| Stream/Video | Video encoding, live streaming | Separate product domain |
| Spectrum | TCP/UDP proxy | Network-level |
| Analytics/Logs | Web Analytics, Logpush | Operations, not development |

**Implication for skill design:** The skill needs to provide a "query scoping" guide that teaches Claude to always include product-specific keywords in MCP queries (e.g., "Workers KV list keys" not just "list keys").

---

## Integration Architecture

### Recommended Approach: Dual MCP Section in SKILL.md

Expand the current single-MCP section into a dual-MCP section:

```markdown
## MCP Integration

### Astro Documentation
**Tool:** `mcp__astro_doc__search_astro_docs`

Use for: Astro API signatures, config options, migration guides, integration setup.

### Cloudflare Documentation
**Tool:** `mcp__cloudflare__search_cloudflare_documentation`

Use for: Workers runtime API, KV/D1/R2 binding API details, compatibility flags,
Workers limits reference, Cloudflare-specific error codes.

### Use THIS SKILL when you need:
- Architecture decisions (rendering mode, hydration, Actions vs API routes)
- Anti-patterns and Astro 5.x breaking change prevention
- Cloudflare-specific patterns (bindings, Workers limits, `.dev.vars`)
- Troubleshooting symptoms and fixes
```

### Three-Way Boundary: Skill vs. Astro MCP vs. Cloudflare MCP

| Question Type | Source | Example |
|---------------|--------|---------|
| "How should I structure my rendering?" | **SKILL** (decision matrix) | Rendering mode decision matrix in SKILL.md |
| "What options does `defineAction` accept?" | **Astro MCP** | `search_astro_docs("defineAction options parameters")` |
| "What is the KV put API signature?" | **Cloudflare MCP** | `search_cloudflare_documentation("Workers KV put API parameters")` |
| "Should I use KV or D1 for sessions?" | **SKILL** (decision matrix) | Cloudflare-platform.md decision matrix |
| "How do I create a D1 database?" | **Cloudflare MCP** | `search_cloudflare_documentation("D1 create database wrangler")` |
| "What are Workers CPU time limits?" | **Cloudflare MCP** | `search_cloudflare_documentation("Workers CPU time limits paid free")` |
| "How do I access bindings in Astro?" | **SKILL** (pattern) | cloudflare-platform.md Bindings Access section |
| "What does `imageService: 'compile'` do?" | **Astro MCP** | `search_astro_docs("cloudflare adapter imageService compile")` |
| "How do I configure compatibility_date?" | **Cloudflare MCP** | `search_cloudflare_documentation("Workers compatibility date flags")` |

### Query Template Strategy

The skill should include query templates for common Cloudflare MCP lookups to ensure relevant results:

| Topic | Recommended Query Pattern | Why This Phrasing |
|-------|---------------------------|-------------------|
| KV operations | `"Workers KV [operation] API"` | Scopes to Workers KV, not general KV |
| D1 queries | `"D1 database [operation] SQL"` | Scopes to D1, not general database docs |
| R2 objects | `"R2 object storage [operation]"` | Scopes to R2 product |
| Worker limits | `"Workers platform limits [resource]"` | Scopes to limits page |
| Compat flags | `"Workers compatibility flags [flag name]"` | Scopes to compat reference |
| Durable Objects | `"Durable Objects [concept] API"` | Scopes to DO product |
| Wrangler CLI | `"Wrangler CLI [command]"` | Scopes to CLI reference |
| Error codes | `"Workers error [code or message]"` | Scopes to Workers errors |

---

## Reference File Integration Points

### Files That Need Cloudflare MCP References

Based on the existing 11 reference files, these are the ones that discuss Cloudflare platform details where MCP query hints should be added:

| Reference File | Cloudflare MCP Relevance | Suggested MCP Hints |
|----------------|--------------------------|---------------------|
| **cloudflare-platform.md** | PRIMARY -- all bindings, limits, env vars | KV/D1/R2 API details, compat flags, Workers limits |
| **build-deploy.md** | HIGH -- wrangler commands, deploy config | Wrangler CLI reference, Workers Static Assets config |
| **rendering-modes.md** | LOW -- only Server Islands need Workers | Server Islands are Astro-side, not Cloudflare-side |
| **data-content.md** | MEDIUM -- SSR data fetching hits Cloudflare APIs | D1 query API, KV operations for caching |
| **security-advanced.md** | MEDIUM -- secrets management, auth patterns | Workers secrets, environment variables |
| **routing-navigation.md** | LOW -- routing is Astro-side | `_routes.json` generation is Astro adapter config |
| **typescript-testing.md** | LOW -- types are generated by wrangler | `wrangler types` command reference |
| **styling-performance.md** | LOW -- only Cloudflare Image Resizing | Image Resizing API (if using `imageService: 'cloudflare'`) |
| **components-islands.md** | NONE -- purely Astro-side | No Cloudflare MCP needed |
| **seo-i18n.md** | NONE -- purely Astro-side | No Cloudflare MCP needed |
| **project-structure.md** | NONE -- purely Astro-side | No Cloudflare MCP needed |

### Integration Approach Per File

For each relevant reference file, add a concise "For official API details" hint at the end of sections that reference Cloudflare APIs. Pattern:

```markdown
> **API reference:** `mcp__cloudflare__search_cloudflare_documentation("Workers KV put get delete API")`
```

This mirrors how the existing skill references `mcp__astro_doc__search_astro_docs` in the MCP Integration section of SKILL.md, but scatters specific query hints closer to where they're needed.

---

## Slash Command Integration

### debug.md Updates Needed

The debug command's "If No Match Found" section (Step 7) currently suggests:
```
mcp__astro_doc__search_astro_docs({ query: "<relevant search terms>" })
```

For Cloudflare-specific errors, it should ALSO suggest:
```
mcp__cloudflare__search_cloudflare_documentation({ query: "<cloudflare-specific search terms>" })
```

**Routing heuristic:**
- Error mentions Astro APIs, config, components -> Astro MCP
- Error mentions Workers, bindings, KV, D1, R2, wrangler, compatibility -> Cloudflare MCP
- Error mentions both -> Try both

### audit.md Updates Needed

The audit command checks Cloudflare configuration (wrangler.jsonc, compatibility flags, bindings). When it encounters unfamiliar configuration or needs to verify current best practices, it should suggest the Cloudflare MCP for verification.

### scaffold.md Updates Needed

Minimal changes. The scaffold command uses templates from reference files. The Cloudflare MCP would only be useful if the user asks about a Cloudflare product the skill doesn't cover (e.g., Vectorize, Browser Rendering).

---

## What NOT to Do with the Cloudflare MCP

### Anti-Patterns for MCP Usage

| Anti-Pattern | Why Bad | Instead |
|--------------|---------|---------|
| Query without product keyword | Returns irrelevant results from wrong product | Always include "Workers", "KV", "D1", "R2" etc. in query |
| Use MCP for architecture decisions | MCP returns facts, not opinions | Use SKILL decision matrices for "should I use X or Y?" |
| Query for Astro-specific Cloudflare adapter | Not in Cloudflare docs (it's in Astro docs) | Use `search_astro_docs` for adapter config |
| Duplicate skill content via MCP queries | Wastes tokens, may contradict skill's opinionated guidance | Trust skill for patterns, MCP for raw API reference |
| Query for dashboard/GUI configuration | Returns non-programmatic instructions | Query specifically for "Workers API" or "wrangler CLI" |
| Use MCP as a substitute for skill's troubleshooting | MCP has no error-to-fix mapping, just raw docs | Use skill's troubleshooting tables first, MCP for deeper detail |

### The Boundary Problem

The biggest risk is **boundary confusion** -- Claude not knowing which MCP to use, or using MCP when the skill already has the answer. The three-way boundary must be crystal clear:

1. **SKILL first** -- Always check skill's decision matrices, anti-patterns, and troubleshooting before MCP
2. **Astro MCP** for Astro framework questions (API signatures, config options, component APIs)
3. **Cloudflare MCP** for Cloudflare platform questions (runtime APIs, service bindings, product features)

If the skill's MCP Integration section is vague, Claude will default to training data instead of using either MCP. The skill must be prescriptive: "For KV API details, use the Cloudflare MCP tool."

---

## Token Impact Analysis

### Current Token Budget (v0.1)

| Layer | Current | After v0.2 |
|-------|---------|------------|
| SKILL.md body | ~237 lines (~1,900 tokens) | ~260-280 lines (~2,100-2,200 tokens) |
| MCP Integration section | ~18 lines (~140 tokens) | ~40-50 lines (~320-400 tokens) |
| Reference file overhead | 0 (MCP hints inline) | ~5-15 lines per relevant file (~40-120 tokens each) |

**Total estimated token increase:** ~300-500 tokens across all files. Well within the 500-line SKILL.md limit and negligible in reference files.

### SKILL.md Line Budget

Current SKILL.md is 237 body lines. The MCP Integration section expansion adds ~25-35 lines. New total: ~262-272 lines. Still well under the 500-line limit with ~230 lines of margin.

---

## Empirical Validation Needed

The following items could NOT be verified due to WebSearch/WebFetch being unavailable. They must be validated during implementation:

### HIGH Priority Validation

| Item | What to Verify | How |
|------|---------------|-----|
| Tool parameter schema | Exact parameters accepted (just `query`? or more?) | Call the tool with a test query and inspect behavior |
| Return format | Structure of returned documentation excerpts | Call the tool and examine output format |
| Query effectiveness | Do product-scoped queries return relevant results? | Test with query templates listed above |
| Corpus coverage | Does it cover Workers, KV, D1, R2, Durable Objects, Queues? | Test specific product queries |
| Freshness | Is the documentation current (2025-2026 compat flags, etc.)? | Query for recent features (e.g., `nodejs_compat_populate_process_env`) |

### MEDIUM Priority Validation

| Item | What to Verify | How |
|------|---------------|-----|
| Rate limits | Any throttling on MCP tool calls? | Use tool repeatedly in a session |
| Result length | How much text is returned per query? | Compare with Astro MCP output length |
| Multi-topic queries | Can one query cover multiple products? | Test "Workers KV and D1 comparison" |
| Error handling | What happens with empty/bad queries? | Test edge cases |

---

## Implementation Recommendation

### Phase Structure for v0.2

Based on this research, the integration work is primarily **content editing** (not architecture changes). Recommended execution order:

1. **Validate tool empirically** -- Call `mcp__cloudflare__search_cloudflare_documentation` with test queries to confirm parameters, return format, and product coverage. This unblocks all other work.

2. **Update SKILL.md MCP Integration section** -- Expand from single-MCP to dual-MCP with three-way boundary. This is the highest-impact change (Claude reads SKILL.md on every activation).

3. **Add MCP query hints to reference files** -- Starting with cloudflare-platform.md (most Cloudflare API references), then build-deploy.md, data-content.md, security-advanced.md.

4. **Update slash commands** -- Add Cloudflare MCP fallback to debug.md, verify audit.md and scaffold.md.

5. **Validation** -- Test that Claude correctly routes to Cloudflare MCP vs. Astro MCP vs. skill for different question types.

### Estimated Effort

| Task | Lines Changed | Complexity |
|------|--------------|------------|
| SKILL.md MCP section expansion | ~30 new lines | Low |
| cloudflare-platform.md MCP hints | ~15-20 new lines | Low |
| build-deploy.md MCP hints | ~8-10 new lines | Low |
| data-content.md MCP hints | ~5-8 new lines | Low |
| security-advanced.md MCP hints | ~5-8 new lines | Low |
| debug.md Cloudflare MCP fallback | ~10-15 new lines | Low |
| audit.md minor updates | ~5-8 new lines | Low |
| Validation testing | N/A | Medium |

**Total: ~80-110 new lines across 7 files.** This is a content integration, not a structural change.

---

## Sources

### Project Sources (HIGH confidence)
- `.claude/skills/astro-cloudflare/SKILL.md` -- Current skill structure and MCP pattern
- `.planning/PROJECT.md` -- v0.2 milestone definition, tool name confirmed
- `.planning/milestones/v0.1-integration-report.md` -- Integration patterns to maintain
- `.planning/research/STACK.md` -- v0.1 stack research for skill architecture

### Training Data (MEDIUM confidence -- needs empirical validation)
- Cloudflare MCP server (`@cloudflare/mcp-server-cloudflare`) -- known from training data as of May 2025
- Cloudflare developer documentation structure at developers.cloudflare.com
- MCP tool naming convention (`mcp__{server}__{tool}`)

### NOT Verified (LOW confidence)
- Exact tool parameter schema beyond `query: string`
- Exact return format and structure
- Whether additional Cloudflare MCP tools exist beyond `search_cloudflare_documentation`
- Current npm package version of the MCP server
- Whether the tool searches all of developers.cloudflare.com or a subset

---

## Confidence Assessment

| Area | Level | Reason |
|------|-------|--------|
| Tool name | HIGH | Confirmed in PROJECT.md and matches MCP naming convention |
| Tool parameter (`query`) | MEDIUM | Consistent with Astro MCP pattern and training data, but not empirically verified |
| Return format | LOW | Training data only, WebFetch unavailable to verify |
| Product coverage | MEDIUM | Cloudflare docs structure well-known, but specific search behavior unverified |
| Integration approach | HIGH | Mirrors proven v0.1 Astro MCP pattern, minimal architectural risk |
| Token impact | HIGH | Simple line-count arithmetic on known file sizes |
| Three-way boundary design | HIGH | Logical extension of proven two-way boundary from v0.1 |
| Query template effectiveness | LOW | Templates designed from documentation structure knowledge, but untested |

---

## Open Questions for Phase-Specific Research

1. **Does the Cloudflare MCP server expose additional tools?** The server name suggests it may have tools beyond documentation search (e.g., account management, deployment). Only `search_cloudflare_documentation` is needed for v0.2, but knowing the full tool list avoids surprises.

2. **Can the MCP tool be called from within SKILL.md examples?** The Astro MCP is referenced as `mcp__astro_doc__search_astro_docs("query")` in SKILL.md. Need to confirm the Cloudflare tool follows the same invocation pattern.

3. **What is the optimal query length?** Short queries ("KV put") vs. detailed queries ("Workers KV Namespace put method parameters TypeScript") -- which yields better results?

4. **Are there server-specific configuration requirements?** Does the `cloudflare` MCP server need API tokens, account IDs, or other configuration beyond what the user has already set up?
