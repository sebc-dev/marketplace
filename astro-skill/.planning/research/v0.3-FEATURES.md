# Feature Landscape: XML Semantic Restructuring of Reference Files

**Domain:** Claude Code Skill reference file structure (XML containers + Markdown content)
**Researched:** 2026-02-04
**Overall Confidence:** HIGH (patterns verified against project's own XML/Markdown guide, Anthropic official XML recommendations, and empirical analysis of all 11 reference files)

---

## Context

v0.3 restructures the existing 11 reference files with XML semantic containers. The content stays identical -- same rules, same tables, same code examples, same troubleshooting. Only the structural markup changes: Markdown headers and sections get wrapped in descriptive XML tags that create attention boundaries for Claude's transformer mechanism.

### Current File Structure (All 11 Files)

Every reference file follows this consistent layout:

```
# [Title]                       <- H1, file description
## Quick Reference              <- 8-14 numbered rules
## [Decision Matrix]            <- 1-3 decision tables (varies per file)
## [Pattern Sections]           <- Code examples with explanation
## Anti-patterns                <- Don't/Do/Impact table
## Troubleshooting              <- Symptom/Cause/Fix table
```

Some files also contain:
- MCP callouts (blockquote format, added in v0.2)
- Feature compatibility tables
- Config templates (code blocks with comments)
- Multi-step patterns (sequential code blocks)

### Source Guide Principles

The project's XML/Markdown guide (`docs/cc-skills/XML Markdown pour references Skill Caude Code.md`) establishes:

1. **XML for semantic structure, Markdown for content** -- tags delimit functional zones, Markdown structures content within zones
2. **snake_case tag names** -- `<error_handling>` not `<errorHandling>`
3. **Tags describe content, not format** -- `<api_conventions>` not `<section_2>`
4. **No tag/header duplication** -- the tag names the zone, headers subdivide within it
5. **Separate `<rules>` from `<examples>`** -- Claude distinguishes "follow" from "imitate" better when separated
6. **Attributes for same-type elements** -- `<pattern name="repository">` for repeated element types
7. **Max 2-3 nesting levels** -- beyond that, benefits diminish
8. **Overhead threshold** -- files >500 tokens with 3+ sections justify XML; below that, Markdown suffices

All 11 reference files are well above the threshold (150-350 lines each, 5-8 distinct sections).

---

## Content Type Inventory

Before mapping XML patterns, here is the exhaustive inventory of content types across all 11 files.

| Content Type | Occurrences | Files | Current Format |
|-------------|-------------|-------|----------------|
| Quick Reference rules | 11 | All files | `## Quick Reference` + numbered list (8-14 items) |
| Decision matrix tables | 18 | All files (1-3 per file) | `## [Name] Decision Matrix` + Markdown table |
| Anti-pattern tables | 11 | All files | `## Anti-patterns` + Don't/Do/Impact table |
| Troubleshooting tables | 11 | All files | `## Troubleshooting` + Symptom/Cause/Fix table |
| Code examples (single block) | ~45 | All files | Fenced code block with comment header |
| Code examples (multi-step) | ~12 | 6 files | Sequential fenced blocks showing a pattern |
| Config templates | ~15 | 5 files | Named code blocks (astro.config, wrangler, tsconfig) |
| Feature compatibility tables | 3 | rendering-modes, components-islands, cloudflare-platform | Feature/Mode matrix |
| MCP callouts | 10 | 4 files | Blockquote (`> **Cloudflare MCP:** ...`) |
| Naming convention tables | 2 | project-structure, routing-navigation | Element/Convention/Example |
| File tree diagrams | 4 | project-structure, data-content | Fenced code block with tree structure |
| Comparison tables | 5 | components-islands, data-content, seo-i18n | Need/Approach/Why table |
| Workers limits table | 1 | cloudflare-platform | Resource/Free/Paid/Workaround |
| Node.js compat table | 2 | cloudflare-platform | Module/Status/Notes |

---

## Table Stakes

XML patterns that MUST be applied to each content type. Missing any of these defeats the purpose of the restructuring.

### TS-1: `<quick_reference>` Container for Rules

| Aspect | Detail |
|--------|--------|
| **Content type** | Quick Reference sections (8-14 numbered rules per file) |
| **Tag name** | `<quick_reference>` |
| **Why expected** | These are the highest-value rules in each file -- Claude must treat them as imperative directives. The `<rules>` tag from the guide is the closest semantic match, but `<quick_reference>` preserves the existing naming and avoids confusion with other rule-like content (anti-patterns also contain rules). |
| **Complexity** | Low |
| **Current format** | `## Quick Reference` + numbered Markdown list |
| **Target format** | `<quick_reference>` wrapping the numbered list, `## Quick Reference` header removed (tag replaces it) |
| **Grep impact** | `grep -n "## Quick Reference"` must be updated to `grep -n "<quick_reference>"` in SKILL.md |

**Before:**
```markdown
## Quick Reference

1. Use `output: 'static'` (default) for sites with mostly static pages
2. Never use `output: 'hybrid'` -- removed in Astro 5.0
...
```

**After:**
```xml
<quick_reference>
1. Use `output: 'static'` (default) for sites with mostly static pages
2. Never use `output: 'hybrid'` -- removed in Astro 5.0
...
</quick_reference>
```

**Tag name rationale:** Using `<quick_reference>` rather than generic `<rules>` because:
- 11 files all share this exact section name -- consistency matters
- Distinguishes from anti-pattern rules which are also prescriptive
- The guide says tags describe content, and "quick reference" IS the content type
- Grep patterns in SKILL.md can target this specific tag

**Alternative considered:** `<rules>` -- rejected because anti-patterns also contain rules ("Don't do X, Do Y"), and the guide explicitly separates `<rules>` from `<examples>`. Using `<rules>` for Quick Reference AND having anti-patterns as implicit rules creates semantic ambiguity.

### TS-2: `<decision_matrix>` Container with `name` Attribute

| Aspect | Detail |
|--------|--------|
| **Content type** | Decision matrix tables (18 across all files) |
| **Tag name** | `<decision_matrix name="[topic]">` |
| **Why expected** | Multiple decision matrices per file require differentiation. The guide's attribute pattern (`<pattern name="X">`) applies perfectly. This is the primary use case for XML attributes in the reference files. |
| **Complexity** | Low |
| **Current format** | `## [Name] Decision Matrix` or `## [Name]` + table |
| **Target format** | `<decision_matrix name="rendering_mode">` wrapping the table, Markdown header inside for sub-sections if needed |
| **Grep impact** | `grep -n "## Decision Matrix"` becomes `grep -n 'decision_matrix name="rendering'` or similar |

**Before:**
```markdown
## Rendering Mode

| Scenario | Mode | Config |
|----------|------|--------|
| Pure static site | SSG | `output: 'static'`, no adapter |
...
```

**After:**
```xml
<decision_matrix name="rendering_mode">
| Scenario | Mode | Config |
|----------|------|--------|
| Pure static site | SSG | `output: 'static'`, no adapter |
...
</decision_matrix>
```

**Attribute naming convention:** Use snake_case matching the tag convention. The `name` value should be a condensed, unique identifier derived from the original heading:
- "Rendering Mode" -> `name="rendering_mode"`
- "Hydration Directive Decision Matrix" -> `name="hydration_directive"`
- "Loader Selection Matrix" -> `name="loader_selection"`
- "Security Decision Matrix" -> `name="security"`
- "Actions vs API Routes" -> `name="actions_vs_api_routes"`

### TS-3: `<anti_patterns>` Container

| Aspect | Detail |
|--------|--------|
| **Content type** | Anti-pattern tables (11, one per file) |
| **Tag name** | `<anti_patterns>` |
| **Why expected** | Anti-patterns are a distinct semantic zone: "things to NOT do." Separating them from positive patterns creates a clear attention boundary. Claude processes prohibitions differently from instructions. |
| **Complexity** | Low |
| **Current format** | `## Anti-patterns` + Don't/Do/Impact table |
| **Target format** | `<anti_patterns>` wrapping the table |
| **Grep impact** | `grep -n "## Anti-patterns"` becomes `grep -n "<anti_patterns>"` |

**Before:**
```markdown
## Anti-patterns

| Don't | Do | Impact |
|-------|-----|--------|
| `output: 'hybrid'` | Use `'static'` or `'server'` | Config error |
...
```

**After:**
```xml
<anti_patterns>
| Don't | Do | Impact |
|-------|-----|--------|
| `output: 'hybrid'` | Use `'static'` or `'server'` | Config error |
...
</anti_patterns>
```

### TS-4: `<troubleshooting>` Container

| Aspect | Detail |
|--------|--------|
| **Content type** | Troubleshooting tables (11, one per file) |
| **Tag name** | `<troubleshooting>` |
| **Why expected** | Troubleshooting is a distinct use case: user has a symptom, needs a fix. This section is often accessed via SKILL.md's Quick Troubleshooting Index. A clean XML boundary makes it targetable. |
| **Complexity** | Low |
| **Current format** | `## Troubleshooting` + Symptom/Cause/Fix table |
| **Target format** | `<troubleshooting>` wrapping the table |
| **Grep impact** | `grep -n "## Troubleshooting"` becomes `grep -n "<troubleshooting>"` |

### TS-5: `<code_example>` or `<pattern>` Container with `name` Attribute for Code Sections

| Aspect | Detail |
|--------|--------|
| **Content type** | Code example sections (~45 single blocks, ~12 multi-step, ~15 config templates) |
| **Tag name** | `<pattern name="[identifier]">` for reusable patterns; inline code within other containers for illustrative snippets |
| **Why expected** | Code sections are the bulk of reference file content. Without containers, Claude cannot distinguish "this code illustrates the nanostores pattern" from "this code shows the Server Island pattern." Named containers create retrievable, identifiable code zones. |
| **Complexity** | Medium -- requires judgment about which code blocks deserve their own container vs staying inside a parent container |
| **Current format** | `## [Pattern Name]` + code block(s) + explanation text |
| **Target format** | `<pattern name="nanostores">` wrapping heading, explanation, and code blocks together |
| **Grep impact** | `grep -n "## Nanostores Pattern"` becomes `grep -n 'pattern name="nanostores"'` |

**Decision rule for code containers:**

| Code Block Type | Container Strategy | Rationale |
|----------------|-------------------|-----------|
| Named pattern with explanation | `<pattern name="X">` | Self-contained, retrievable unit |
| Config template | `<config_template name="X">` | Distinct from patterns -- these are copy-paste starting points |
| Illustrative snippet inside a section | Stays inside parent container | Not standalone, supports surrounding text |
| Multi-step code example | `<pattern name="X">` wrapping all steps | Steps are part of one logical unit |

**Before (nanostores pattern):**
```markdown
## Nanostores Pattern

```typescript
// src/stores/cart.ts -- single source of truth
import { atom, map } from 'nanostores';
...
```

**Key rules:**
- Use `.get()` in event handlers
...
```

**After:**
```xml
<pattern name="nanostores">
## Store Definition and Usage

```typescript
// src/stores/cart.ts -- single source of truth
import { atom, map } from 'nanostores';
...
```

## Key Rules
- Use `.get()` in event handlers
...
</pattern>
```

### TS-6: `<mcp_callout>` or Inline MCP Blockquotes (Keep As-Is)

| Aspect | Detail |
|--------|--------|
| **Content type** | MCP callouts (10 across 4 files) |
| **Tag name** | **Keep existing blockquote format** -- do NOT wrap in XML |
| **Why expected** | MCP callouts are inline hints within other sections, not standalone sections. They appear after content paragraphs to say "for more, use MCP." Wrapping them in XML would over-tag and fragment the parent container. |
| **Complexity** | None (no change) |
| **Current format** | `> **Cloudflare MCP:** For complete KV/D1/R2 binding method signatures, query...` |
| **Target format** | Same blockquote, positioned inside whichever XML container holds the surrounding content |

**Rationale:** The XML guide explicitly warns against over-tagging. MCP callouts are 1-2 lines each, not separate functional zones. They are supplementary annotations within a section, analogous to footnotes. Wrapping each in `<mcp_callout>` would add 20 XML tag tokens for 10 callouts while fragmenting the parent containers.

### TS-7: SKILL.md Grep Pattern Updates

| Aspect | Detail |
|--------|--------|
| **Content type** | 102 grep patterns in SKILL.md's Reference Navigation section |
| **Why expected** | Every grep pattern targets a `## Heading`. After restructuring, some headings become XML tags. If grep patterns break, the skill's navigation system fails. |
| **Complexity** | Medium -- 102 patterns to audit, estimated 40-60 need updating |
| **What** | Update each grep pattern to target the new XML tag or remaining Markdown heading |

**Pattern migration strategy:**

| Current Pattern | New Pattern | Notes |
|----------------|-------------|-------|
| `grep -n "## Quick Reference"` | `grep -n "<quick_reference>"` | All 11 files |
| `grep -n "## Anti-patterns"` | `grep -n "<anti_patterns>"` | All 11 files |
| `grep -n "## Troubleshooting"` | `grep -n "<troubleshooting>"` | All 11 files |
| `grep -n "## Decision Matrix"` | `grep -n 'decision_matrix name="'` | Varies per file |
| `grep -n "## [Pattern Name]"` | `grep -n 'pattern name="[id]"'` | Named patterns |
| `grep -n "## [Section]"` | Unchanged if header remains inside container | Headers within containers keep working |

**Critical constraint:** Some grep patterns target Markdown headers INSIDE XML containers. These do NOT change. For example:
- `grep -n "## URL Structure"` inside `<pattern name="routing_rules">` -- this header still exists, grep still works
- Only TOP-LEVEL section markers that become XML tags need grep updates

---

## Differentiators

Advanced patterns that add extra value beyond basic wrapping. Not required for the restructuring to work, but measurably improve Claude's attention targeting.

### D-1: `<feature_compatibility>` for Cross-Feature Matrices

| Aspect | Detail |
|--------|--------|
| **Content type** | Feature compatibility tables (3 files) |
| **Tag name** | `<feature_compatibility>` |
| **Value proposition** | These tables are structurally different from decision matrices -- they answer "what works where" rather than "what should I choose." A distinct tag lets Claude locate compatibility information without scanning decision matrices. |
| **Complexity** | Low |
| **Files affected** | rendering-modes.md, cloudflare-platform.md |

### D-2: `<config_template name="X">` for Config Code Blocks

| Aspect | Detail |
|--------|--------|
| **Content type** | Configuration templates (astro.config variants, tsconfig, wrangler.jsonc, env.d.ts, content.config.ts, package.json) |
| **Tag name** | `<config_template name="astro_config_ssr">` |
| **Value proposition** | Config templates are copy-paste starting points, functionally different from illustrative code examples. A `config_template` tag signals "use this as a starting point" vs `pattern` which signals "follow this approach." |
| **Complexity** | Low |
| **Files affected** | project-structure.md (7 configs), cloudflare-platform.md (2 configs), build-deploy.md (1 config) |

### D-3: Nested Containers for Complex Sections

| Aspect | Detail |
|--------|--------|
| **Content type** | Sections with sub-patterns (e.g., "Bindings Access" in cloudflare-platform.md has sub-sections for .astro pages, API endpoints, middleware, Actions, AsyncLocalStorage) |
| **Tag name** | Outer: `<pattern name="bindings_access">`, no inner tags -- use Markdown headers for sub-items |
| **Value proposition** | The guide limits nesting to 2-3 levels. For sections with sub-patterns, ONE XML container with Markdown sub-headers inside is the sweet spot. Avoids over-tagging while preserving the attention boundary. |
| **Complexity** | Low |

**Recommendation:** Do NOT nest XML within XML for sub-sections. Use one container with Markdown headers inside. This follows the guide's anti-pattern on granularity:

```xml
<!-- CORRECT: One container, headers inside -->
<pattern name="bindings_access">
## In .astro Pages
...
## In API Endpoints
...
## In Middleware
...
</pattern>

<!-- INCORRECT: Nested XML for each sub-pattern -->
<pattern name="bindings_access">
  <sub_pattern name="astro_pages">...</sub_pattern>
  <sub_pattern name="api_endpoints">...</sub_pattern>
</pattern>
```

### D-4: `<workers_limits>` Semantic Container for Platform Constraints

| Aspect | Detail |
|--------|--------|
| **Content type** | Workers limits table, Node.js compatibility table |
| **Tag name** | `<workers_limits>` and `<nodejs_compat>` |
| **Value proposition** | These are reference lookup tables, not decision matrices or patterns. Distinct tags create precise attention targets for "what are the limits?" queries. |
| **Complexity** | Low |
| **Files affected** | cloudflare-platform.md |

### D-5: File-Level Descriptor Comment

| Aspect | Detail |
|--------|--------|
| **What** | Add an XML comment at the top of each file describing its XML structure |
| **Value proposition** | Helps future maintainers (including Claude in edit mode) understand the container layout without reading the full file |
| **Complexity** | Low |

```xml
<!-- Reference: rendering-modes.md
     Containers: quick_reference, decision_matrix (2), pattern (2), feature_compatibility, anti_patterns, troubleshooting
     MCP callouts: 0 -->
```

---

## Anti-Features

XML patterns to deliberately NOT use. Each is a mistake that looks reasonable but degrades the skill.

### AF-1: Do NOT Use `<rules>` and `<examples>` Separation

| Anti-Feature | Why Avoid | What to Do Instead |
|-------------|-----------|-------------------|
| Splitting Quick Reference into `<rules>` + `<examples>` | The Quick Reference sections contain RULES ONLY -- they are already pure directives with no intermixed examples. The guide's `<rules>`/`<examples>` separation pattern applies when rules and examples are mixed in the same section. Our files don't have this problem. Artificial splitting would scatter numbered rules across two containers. | Use `<quick_reference>` as a single container for the numbered rules. Code examples live in separate `<pattern>` or `<config_template>` containers elsewhere in the file. |

### AF-2: Do NOT Wrap Individual Table Rows in XML

| Anti-Feature | Why Avoid | What to Do Instead |
|-------------|-----------|-------------------|
| `<anti_pattern name="hybrid">` around each row of the anti-patterns table | Over-tagging. The guide explicitly calls this out: "chaque paragraphe dans sa propre balise" is an anti-pattern. Anti-pattern tables are already well-structured with Markdown table syntax. One container around the whole table is sufficient. | One `<anti_patterns>` tag wrapping the entire table. |

### AF-3: Do NOT Use XML for the H1 Title and Intro

| Anti-Feature | Why Avoid | What to Do Instead |
|-------------|-----------|-------------------|
| `<file_header>` or `<description>` around the `# Title` and subtitle | The H1 and introductory line are metadata, not a functional zone. They consume 2-3 lines. Wrapping them adds XML overhead for zero attention benefit. Claude already understands `# Title` as the document header. | Keep the `# Title` and intro line as plain Markdown before the first XML container. |

### AF-4: Do NOT Use `<section>` as a Generic Wrapper

| Anti-Feature | Why Avoid | What to Do Instead |
|-------------|-----------|-------------------|
| `<section name="output_modes">` instead of a descriptive tag | The guide says tags describe content, not format. `<section>` is a format descriptor like `<div>` in HTML -- it conveys no semantic meaning. Claude gains nothing from `<section>` that it wouldn't get from a Markdown header. | Use descriptive tags: `<decision_matrix>`, `<pattern>`, `<config_template>`, `<feature_compatibility>`. If no specific tag fits, the content may not warrant XML wrapping. |

### AF-5: Do NOT Add Conditional Logic Tags

| Anti-Feature | Why Avoid | What to Do Instead |
|-------------|-----------|-------------------|
| `<if_ssr>`, `<when mode="server">` | The guide explicitly lists conditional logic (`<if mode="yolo">`) as a GSD-specific pattern that does NOT apply to reference files. Reference files are descriptive, not prescriptive. | Use decision matrices to express conditionals as lookup tables. |

### AF-6: Do NOT Nest More Than 2 Levels

| Anti-Feature | Why Avoid | What to Do Instead |
|-------------|-----------|-------------------|
| `<pattern><sub_pattern><code>` three levels deep | The guide limits nesting to 2-3 levels, noting benefits diminish beyond that. Code blocks inside a `<pattern>` container is already 2 levels (container + code fence). Adding a third XML level wastes tokens. | One XML container, Markdown headers inside, code blocks as children. Maximum structure: `<pattern>` -> `## Heading` -> ````code```` |

### AF-7: Do NOT Change the Content

| Anti-Feature | Why Avoid | What to Do Instead |
|-------------|-----------|-------------------|
| Rewriting rules while adding XML, adding new examples, fixing typos | v0.3 scope is STRUCTURAL ONLY. Mixing content changes with structural changes makes regression detection impossible. If a grep pattern breaks, was it the XML restructuring or the content edit? | Pure XML wrapping. Zero content changes. File the content improvements as separate issues for v0.4. |

---

## Feature Dependencies

```
TS-1 (quick_reference) ─┐
TS-2 (decision_matrix)  ─┤
TS-3 (anti_patterns)    ─┼── TS-7 (grep pattern updates)
TS-4 (troubleshooting)  ─┤       │
TS-5 (code patterns)    ─┘       │
                                  v
                          Validation: 102 grep patterns
                          must still resolve to correct
                          line numbers in reference files
```

**Critical path:** All container tags (TS-1 through TS-5) must be applied BEFORE grep patterns (TS-7) can be updated. Grep patterns reference the structural markers. The validation step must run AFTER both containers and grep updates.

**MCP callouts (TS-6):** Independent -- no change needed. Can be validated in parallel.

**Differentiators (D-1 through D-5):** Independent of each other but depend on TS-1 through TS-5 being applied first (they refine the container strategy).

---

## Complete Tag Registry

The definitive list of XML tags to use across all 11 reference files.

| Tag | Attributes | Semantic Meaning | Used In |
|-----|-----------|-----------------|---------|
| `<quick_reference>` | None | Numbered actionable rules Claude must follow | All 11 files |
| `<decision_matrix>` | `name="[topic]"` | Scenario/choice lookup tables | All 11 files (1-3 per file) |
| `<anti_patterns>` | None | Don't/Do tables with severity | All 11 files |
| `<troubleshooting>` | None | Symptom/Cause/Fix tables | All 11 files |
| `<pattern>` | `name="[identifier]"` | Reusable code patterns with explanation | 8 files (~30 instances) |
| `<config_template>` | `name="[identifier]"` | Copy-paste configuration starting points | 3 files (~10 instances) |
| `<feature_compatibility>` | None | Feature/mode cross-reference tables | 2 files |
| `<workers_limits>` | None | Platform resource limits table | 1 file |
| `<nodejs_compat>` | None | Node.js module support status table | 1 file |

**Total unique tag names: 9.** This is a small, memorable vocabulary that covers all content types across 11 files.

**Naming convention enforcement:**
- All tags: `snake_case`
- All attribute values: `snake_case` (e.g., `name="rendering_mode"` not `name="Rendering Mode"`)
- No self-closing tags
- No tag/header duplication (if tag is `<anti_patterns>`, do NOT add `## Anti-patterns` inside)

---

## Before/After Examples

### Example 1: Quick Reference + Decision Matrix (rendering-modes.md)

**Before:**
```markdown
# Rendering Modes

## Quick Reference

1. Use `output: 'static'` (default) for sites with mostly static pages
2. Use `output: 'server'` for apps with mostly dynamic pages
3. Never use `output: 'hybrid'` -- removed in Astro 5.0
...

## Decision Matrix

| Project Type | Mode | Config | Cloudflare Reasoning |
|-------------|------|--------|---------------------|
| Static site (docs, portfolio) | SSG pure | `output: 'static'` | Zero Workers cost |
...
```

**After:**
```xml
# Rendering Modes

<quick_reference>
1. Use `output: 'static'` (default) for sites with mostly static pages
2. Use `output: 'server'` for apps with mostly dynamic pages
3. Never use `output: 'hybrid'` -- removed in Astro 5.0
...
</quick_reference>

<decision_matrix name="rendering_mode">
| Project Type | Mode | Config | Cloudflare Reasoning |
|-------------|------|--------|---------------------|
| Static site (docs, portfolio) | SSG pure | `output: 'static'` | Zero Workers cost |
...
</decision_matrix>
```

### Example 2: Anti-patterns + Troubleshooting (data-content.md)

**Before:**
```markdown
## Anti-patterns

| Don't | Do | Severity |
|-------|-----|----------|
| `type: 'content'` in defineCollection | `loader: glob({ pattern, base })` | CRITICAL |
...

## Troubleshooting

| Symptom | Cause | Fix |
|---------|-------|-----|
| `Cannot find module 'astro:content'` | Config file wrong location | Move to `src/content.config.ts` |
...
```

**After:**
```xml
<anti_patterns>
| Don't | Do | Severity |
|-------|-----|----------|
| `type: 'content'` in defineCollection | `loader: glob({ pattern, base })` | CRITICAL |
...
</anti_patterns>

<troubleshooting>
| Symptom | Cause | Fix |
|---------|-------|-----|
| `Cannot find module 'astro:content'` | Config file wrong location | Move to `src/content.config.ts` |
...
</troubleshooting>
```

### Example 3: Pattern with Code Blocks + MCP Callout (cloudflare-platform.md)

**Before:**
```markdown
## Bindings Access

Access KV, D1, R2, and other bindings through `locals.runtime.env` in every Astro context.

**In .astro pages:**
```astro
---
const { env } = Astro.locals.runtime;
const data = await env.DB.prepare('SELECT * FROM items WHERE id = ?').bind(id).first();
---
```

**In middleware** (guard for prerendering):
```typescript
export const onRequest = defineMiddleware(async (context, next) => {
  if (!context.locals.runtime) return next();
  const { env } = context.locals.runtime;
  return next();
});
```

> **Cloudflare MCP:** For complete KV/D1/R2 binding method signatures, query `mcp__cloudflare__search_cloudflare_documentation`
```

**After:**
```xml
<pattern name="bindings_access">
Access KV, D1, R2, and other bindings through `locals.runtime.env` in every Astro context.

## In .astro Pages
```astro
---
const { env } = Astro.locals.runtime;
const data = await env.DB.prepare('SELECT * FROM items WHERE id = ?').bind(id).first();
---
```

## In Middleware (Guard for Prerendering)
```typescript
export const onRequest = defineMiddleware(async (context, next) => {
  if (!context.locals.runtime) return next();
  const { env } = context.locals.runtime;
  return next();
});
```

> **Cloudflare MCP:** For complete KV/D1/R2 binding method signatures, query `mcp__cloudflare__search_cloudflare_documentation`
</pattern>
```

### Example 4: Config Template (project-structure.md)

**Before:**
```markdown
### astro.config.mjs -- SSR on Cloudflare

```javascript
import { defineConfig } from 'astro/config';
import cloudflare from '@astrojs/cloudflare';
export default defineConfig({
  output: 'server',
  adapter: cloudflare({ imageService: 'compile', platformProxy: { enabled: true } }),
});
```
```

**After:**
```xml
<config_template name="astro_config_ssr">
## astro.config.mjs -- SSR on Cloudflare

```javascript
import { defineConfig } from 'astro/config';
import cloudflare from '@astrojs/cloudflare';
export default defineConfig({
  output: 'server',
  adapter: cloudflare({ imageService: 'compile', platformProxy: { enabled: true } }),
});
```
</config_template>
```

---

## Grep Pattern Integration Strategy

The restructuring changes the targets that SKILL.md grep patterns use. Here is the strategy for each pattern category.

### Patterns That Must Change

| Pattern Category | Count | Current Target | New Target |
|-----------------|-------|---------------|------------|
| Quick Reference | 0 (not currently grepped) | N/A | N/A |
| Anti-patterns | 11 | `## Anti-patterns` | `<anti_patterns>` |
| Troubleshooting | 11 | `## Troubleshooting` | `<troubleshooting>` |
| Decision matrices | ~15 | `## [Matrix Name]` | `decision_matrix name="[id]"` or keep `##` if header stays inside container |
| Named patterns | ~20 | `## [Pattern Name]` | `pattern name="[id]"` or keep `##` if header stays inside container |

### Patterns That Stay Unchanged

Grep patterns targeting Markdown headers INSIDE XML containers continue to work because the headers still exist. For example:

- `grep -n "## URL Structure"` -- if this header exists inside a `<pattern>` container, grep still finds it
- `grep -n "### astro.config.mjs"` -- sub-headers inside `<config_template>` containers remain

### Migration Decision Rule

For each grep pattern in SKILL.md:

1. Does the target heading become an XML tag? -> Update grep to target the XML tag
2. Does the target heading remain as a Markdown header inside a container? -> No change needed
3. Does the target heading get removed (tag replaces it, per no-duplication rule)? -> Update grep to target the XML tag

**Estimated impact:** Of 102 grep patterns, approximately 35-45 need updating (the Anti-patterns, Troubleshooting, and top-level section headers). The remaining 55-65 target sub-headers within containers and stay unchanged.

---

## MVP Recommendation

For the v0.3 restructuring, prioritize in this order:

1. **All table-stakes features (TS-1 through TS-7)** -- these are the core restructuring
2. **D-2: config_template** -- high value, low effort, improves 3 files significantly
3. **D-1: feature_compatibility** -- clarifies an ambiguous content type
4. **D-5: file-level descriptor comments** -- aids maintenance

Defer to later:
- **D-3: Nested container strategy** -- follows naturally from TS-5
- **D-4: workers_limits/nodejs_compat** -- nice-to-have for 1 file

---

## Per-File Application Plan

Summary of how many containers each file gets:

| File | Containers | Tag Types Used |
|------|-----------|---------------|
| project-structure.md | ~10 | quick_reference, pattern (2), config_template (7), anti_patterns, troubleshooting |
| rendering-modes.md | ~7 | quick_reference, decision_matrix (2), pattern (1), feature_compatibility, anti_patterns, troubleshooting |
| components-islands.md | ~9 | quick_reference, decision_matrix (2), pattern (4), anti_patterns, troubleshooting |
| routing-navigation.md | ~9 | quick_reference, decision_matrix (3), pattern (3), anti_patterns, troubleshooting |
| data-content.md | ~10 | quick_reference, decision_matrix (2), pattern (4), config_template (1), anti_patterns, troubleshooting |
| styling-performance.md | ~9 | quick_reference, decision_matrix (2), pattern (4), anti_patterns, troubleshooting |
| seo-i18n.md | ~9 | quick_reference, decision_matrix (2), pattern (4), anti_patterns, troubleshooting |
| cloudflare-platform.md | ~10 | quick_reference, pattern (2), config_template (2), workers_limits, nodejs_compat, anti_patterns, troubleshooting |
| build-deploy.md | ~10 | quick_reference, decision_matrix (3), pattern (3), config_template (1), anti_patterns, troubleshooting |
| security-advanced.md | ~9 | quick_reference, decision_matrix (1), pattern (5), anti_patterns, troubleshooting |
| typescript-testing.md | ~9 | quick_reference, decision_matrix (2), pattern (3), config_template (1), anti_patterns, troubleshooting |

**Total containers across 11 files: ~101 XML open/close tag pairs.**
**Estimated token overhead: ~300 tokens total (average 3 tokens per tag pair x 101).**
**Percentage overhead on ~6,200 lines of content: ~1-2%.** Well within the guide's 5-10% threshold.

---

## Sources

- Project guide: `docs/cc-skills/XML Markdown pour references Skill Caude Code.md` (HIGH confidence -- primary source for this project)
- Project guide: `docs/cc-skills/Transformer une documentation technique volumineuse en Claude Code Skill optimise.md` (HIGH confidence)
- Project guide: `docs/cc-skills/Guide complet des Skills personnalises pour Claude Code.md` (HIGH confidence)
- Anthropic official: [Use XML tags to structure your prompts](https://docs.anthropic.com/en/docs/build-with-claude/prompt-engineering/use-xml-tags) (HIGH confidence -- verified recommendations via WebSearch)
- Anthropic official: [Skill authoring best practices](https://platform.claude.com/docs/en/agents-and-tools/agent-skills/best-practices) (HIGH confidence)
- WebSearch verification: Anthropic confirms Claude is "fine tuned to pay special attention to XML tag structure" (MEDIUM confidence -- WebSearch sourced)
- Empirical analysis: All 11 reference files read and content-type inventoried (HIGH confidence -- direct observation)
