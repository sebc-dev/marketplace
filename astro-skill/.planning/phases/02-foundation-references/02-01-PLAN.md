---
phase: 02-foundation-references
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .claude/skills/astro-cloudflare/references/project-structure.md
autonomous: true

must_haves:
  truths:
    - "Claude reading project-structure.md knows where to place content.config.ts (src/content.config.ts, not src/content/config.ts)"
    - "Claude can copy-paste a correct astro.config.mjs for SSG, SSR, or hybrid mode on Cloudflare"
    - "Claude knows the correct tsconfig.json include (.astro/types.d.ts, not src/env.d.ts)"
    - "Claude knows naming conventions (PascalCase components, kebab-case pages, exact config file names)"
    - "Claude can generate correct env.d.ts with CloudflareEnv interface and App.Locals typing"
    - "Claude knows correct package.json scripts (wrangler types before astro dev)"
  artifacts:
    - path: ".claude/skills/astro-cloudflare/references/project-structure.md"
      provides: "Astro 5.17+ project structure conventions, naming, config templates for Cloudflare"
      min_lines: 150
      contains: "## Quick Reference"
  key_links:
    - from: ".claude/skills/astro-cloudflare/references/project-structure.md"
      to: "docs/researchs/1 - Architecture.md"
      via: "condensation of research into prescriptive reference"
      pattern: "content\\.config\\.ts"
---

<objective>
Write the complete `project-structure.md` reference file, replacing the title-only stub from Phase 1.

Purpose: Give Claude correct platform-level knowledge for Astro 5.17+ project structure on Cloudflare -- file organization, naming conventions, and copy-pasteable config templates (astro.config.mjs, tsconfig.json, env.d.ts, content.config.ts, package.json scripts, .gitignore).

Output: One reference file at `.claude/skills/astro-cloudflare/references/project-structure.md` (150-250 lines)
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-foundation-references/02-CONTEXT.md
@.planning/phases/02-foundation-references/02-RESEARCH.md
@docs/researchs/1 - Architecture.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Read research sources and draft reference file</name>
  <files>.claude/skills/astro-cloudflare/references/project-structure.md</files>
  <action>
Read the primary source `docs/researchs/1 - Architecture.md` and the RESEARCH.md content map for project-structure.md.

Write `.claude/skills/astro-cloudflare/references/project-structure.md` with this structure:

1. **## Quick Reference** (5-10 lines)
   - Numbered imperative rules, one line each
   - Must include: content.config.ts at src/ root, .astro/types.d.ts in tsconfig, loader: glob() not type: 'content', slug renamed to id, src/assets/ for optimized images vs public/ for static, wrangler types before astro dev
   - Source: Research 1 section 1 rules, verified against RESEARCH.md

2. **## File Organization** (~20-30 lines)
   - Two directory trees: simple site (SSG) and complex site (SSG + SSR + Server Islands)
   - Use compact tree format with inline comments for key conventions
   - Highlight: src/content.config.ts position, src/env.d.ts, src/actions/index.ts, middleware.ts
   - Source: Research 1 section 2, condensed

3. **## Naming Conventions** (~15-20 lines)
   - Table format: Element | Convention | Example
   - Components: PascalCase. Pages: kebab-case. Layouts: PascalCase. Routes: [param]. Collections: kebab-case. Actions: camelCase. Tests: .test.ts / .spec.ts
   - Source: Research 1 section 6

4. **## Config Templates** (~80-100 lines)
   Config files that belong in project-structure.md per CONTEXT.md distribution:
   - **astro.config.mjs**: Three variants (SSG pure, SSR on Cloudflare, static with SSR opt-out). No package versions. Each copy-pasteable
   - **tsconfig.json**: Strict preset, .astro/types.d.ts include, path aliases (@/*)
   - **env.d.ts**: Runtime type with CloudflareEnv interface, App.Locals extends Runtime, App.SessionData
   - **content.config.ts**: Example with glob and file loaders, Zod schemas, collections export
   - **package.json scripts**: wrangler types && astro dev, build with astro check, preview with wrangler pages dev
   - **.gitignore**: .wrangler/, .dev.vars, dist/, .astro/, node_modules/
   - Source: Research 1 sections 3 + 8, verified in RESEARCH.md Code Examples

5. **## Anti-patterns** (~15-20 lines)
   - Table: Don't | Do | Impact
   - Select 8-10 most impactful from Research 1 section 5
   - All presented as absolute rules (no confidence tags per CONTEXT.md)
   - Must include: content.config.ts wrong location, type: 'content', entry.slug, entry.render(), .dev.vars + .env together, Sharp image service, missing .astro/types.d.ts include

6. **## Troubleshooting** (~15-20 lines)
   - Table: Symptom | Cause | Fix
   - Fix must be ONE line (CONTEXT.md constraint). If multi-line needed, point to Config Templates section
   - Select 8-10 most common from Research 1 section 7
   - Must include: Cannot find module 'astro:content', entry.slug undefined, entry.render not a function, .env ignored

CRITICAL CONSTRAINTS from CONTEXT.md (locked decisions):
- Prescriptive tone: "Use X", "Avoid Y" -- not encyclopedic
- 150-250 lines total
- No cross-references to search_astro_docs (reserved for Phase 5)
- No package version numbers in templates
- Tables + code blocks as primary format
- Anti-patterns in dedicated section at end, not inline
- No confidence tags on anti-patterns
- Troubleshooting fix must be one line

WHAT TO EXCLUDE (Claude already knows these):
- Basic .astro file syntax, frontmatter concept, slots
- How HTML/CSS/JS work
- What TypeScript is
- General Node.js concepts
  </action>
  <verify>
1. Count lines: `wc -l .claude/skills/astro-cloudflare/references/project-structure.md` -- must be 150-250
2. Check sections exist: grep for "## Quick Reference", "## File Organization", "## Naming Conventions", "## Config Templates", "## Anti-patterns", "## Troubleshooting"
3. Check no package versions: grep for version-like patterns (should find none in templates)
4. Check no MCP references: grep for "search_astro_docs" (must return nothing)
5. Check key content: grep for "content.config.ts", ".astro/types.d.ts", "imageService", "wrangler types"
  </verify>
  <done>
project-structure.md is 150-250 lines, has all 6 sections, contains copy-pasteable config templates for astro.config.mjs (3 variants), tsconfig.json, env.d.ts, content.config.ts, package.json scripts, and .gitignore. No package versions, no MCP references, prescriptive tone throughout.
  </done>
</task>

<task type="auto">
  <name>Task 2: Cross-verify content accuracy and finalize</name>
  <files>.claude/skills/astro-cloudflare/references/project-structure.md</files>
  <action>
Re-read the written file and verify against the RESEARCH.md "State of the Art" table and "Verified Content Per Reference File" section:

1. Verify Astro 5.x breaking changes are correctly stated:
   - content.config.ts at src/ root (not src/content/)
   - .astro/types.d.ts (not src/env.d.ts auto-generated)
   - loader: glob() (not type: 'content')
   - entry.id (not entry.slug)
   - import { render } from 'astro:content' (not entry.render())
   - output: 'static' or 'server' (not 'hybrid')

2. Verify Cloudflare-specific patterns are correct:
   - imageService: 'compile' or 'passthrough' (not Sharp)
   - platformProxy: { enabled: true }
   - nodejs_compat in compatibility_flags
   - .dev.vars not .env
   - wrangler types before astro dev

3. Verify no overlap with cloudflare-platform.md domain:
   - wrangler.jsonc template should NOT be in this file (goes in cloudflare-platform.md)
   - .dev.vars details should NOT be in this file (goes in cloudflare-platform.md)
   - Workers limits should NOT be here

4. Verify no overlap with rendering-modes.md domain:
   - Decision matrix for SSG/SSR/Server Islands should NOT be here (brief mention in config variants is OK)
   - Server Island patterns should NOT be here

5. Fix any issues found. Final line count must be 150-250.

6. Commit: `feat(02-01): write project-structure.md reference file`
  </action>
  <verify>
1. Re-count lines: 150-250 range confirmed
2. Grep for "hybrid" in astro.config templates -- must NOT appear as a valid option
3. Grep for "wrangler.jsonc" -- should only appear as a filename mention, not a full template
4. Grep for ".dev.vars" -- should only appear in .gitignore, not as a detailed section
  </verify>
  <done>
project-structure.md passes all cross-verification checks: Astro 5.x breaking changes correctly stated, no domain overlap with other Phase 2 reference files, line count within budget, committed to git.
  </done>
</task>

</tasks>

<verification>
- File exists and replaces the stub (more than 1 line)
- Line count: 150-250
- All 6 sections present: Quick Reference, File Organization, Naming Conventions, Config Templates, Anti-patterns, Troubleshooting
- Config templates: astro.config.mjs (3 variants), tsconfig.json, env.d.ts, content.config.ts, package.json scripts, .gitignore
- No package version numbers in code templates
- No search_astro_docs or MCP references
- No wrangler.jsonc template (belongs in cloudflare-platform.md)
- Prescriptive tone, tables + code blocks format
</verification>

<success_criteria>
Claude reading this file can:
1. Set up correct Astro 5.17+ project structure on Cloudflare from scratch
2. Copy-paste any config file and get a working starting point
3. Avoid all Astro 5.x breaking change pitfalls (content.config.ts location, slug->id, render API, types include)
4. Apply correct naming conventions consistently
5. Diagnose common project structure errors via troubleshooting table
</success_criteria>

<output>
After completion, create `.planning/phases/02-foundation-references/02-01-SUMMARY.md`
</output>
