---
phase: 15-final-validation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .planning/phases/15-final-validation/15-01-SUMMARY.md
  - .planning/phases/15-final-validation/15-final-validation-VERIFICATION.md
autonomous: true

must_haves:
  truths:
    - "102/102 grep patterns from SKILL.md pass against all 11 reference files"
    - "Tag vocabulary is consistent across all 11 files -- same tag name always means the same semantic content type"
    - "Every opening XML tag has a matching closing tag, no nesting beyond 1 level, all tag names are snake_case"
    - "Aggregate token overhead across all 11 files is confirmed below 5%"
  artifacts:
    - path: ".planning/phases/15-final-validation/15-final-validation-VERIFICATION.md"
      provides: "Comprehensive verification report documenting all 4 success criteria"
      contains: "ALL CHECKS PASSED"
  key_links:
    - from: ".claude/skills/astro-cloudflare/SKILL.md"
      to: ".claude/skills/astro-cloudflare/references/*.md"
      via: "102 grep -n patterns"
      pattern: 'grep -n ".*" references/'
---

<objective>
Run comprehensive final validation across all 11 XML-tagged reference files to confirm zero regressions, vocabulary consistency, well-formedness, and overhead compliance. Produce a formal VERIFICATION.md documenting every check result.

Purpose: Close out v0.3 with full confidence that the XML semantic restructuring introduced no breakage across the entire skill.
Output: VERIFICATION.md with all 4 success criteria documented as PASS/FAIL with evidence.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/15-final-validation/15-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Run comprehensive validation across all 11 files</name>
  <files>.claude/skills/astro-cloudflare/SKILL.md, .claude/skills/astro-cloudflare/references/*.md</files>
  <action>
Run all 4 validation checks from the research phase. Execute from the repo root directory. No files are modified -- this is read-only validation.

**Check 1: 102/102 grep patterns (VAL-01 + VAL-03)**

Parse SKILL.md for all lines containing `grep -n`, extract each command, execute it against the correct reference file (prefixing paths with `.claude/skills/astro-cloudflare/`). Each pattern must return exactly 1 match (not 0, not 2+). Count passes and failures. Log every FAIL with the pattern and file.

Use this extraction approach:
```bash
SKILL=".claude/skills/astro-cloudflare/SKILL.md"
BASEDIR=".claude/skills/astro-cloudflare"
pass=0; fail=0
while IFS= read -r line; do
  cmd=$(echo "$line" | sed 's/.*`\(grep -n.*\)`.*/\1/')
  pattern=$(echo "$cmd" | sed 's/grep -n "\(.*\)" references\/.*/\1/')
  file=$(echo "$cmd" | sed 's/.*references\//references\//')
  count=$(grep -c "$pattern" "$BASEDIR/$file" 2>/dev/null)
  if [ "$count" -eq 1 ]; then
    pass=$((pass + 1))
  else
    fail=$((fail + 1))
    echo "FAIL ($count matches): $cmd"
  fi
done < <(grep 'grep -n' "$SKILL")
echo "Result: $pass / $((pass + fail))"
```

**Check 2: Tag vocabulary consistency (VAL-02)**

2a. Verify universal tags (quick_reference, anti_patterns, troubleshooting) appear in all 11 files:
```bash
for tag in quick_reference anti_patterns troubleshooting; do
  count=$(grep -rl "^<${tag}>$" .claude/skills/astro-cloudflare/references/*.md | wc -l)
  echo "<$tag> in $count/11 files"
done
```

2b. Find all tags appearing in more than one file and verify semantic consistency:
```bash
for f in .claude/skills/astro-cloudflare/references/*.md; do
  grep -oP '^<([a-z_][a-z_0-9]*)>$' "$f" | sed 's/<//;s/>//'
done | sort | uniq -c | sort -rn | awk '$1 > 1'
```

Expected shared tags: quick_reference (11), anti_patterns (11), troubleshooting (11), config_templates (2). All others should appear in exactly 1 file.

2c. For config_templates specifically, verify both files (cloudflare-platform.md, project-structure.md) use it to wrap `## Config Templates` sections containing configuration examples.

**Check 3: Tag well-formedness**

3a. Balanced open/close tags using HTML-exclusion approach. For each file, extract tag names from opening tags, exclude known HTML tags (head, html, style, nav, template, div, button, script, article, a, p, span, form, input, label, select, option, ul, li, ol, table, tr, td, th, img, br, hr, link, meta, body, footer, header, main, section), then count opens vs closes for each remaining tag:
```bash
for f in .claude/skills/astro-cloudflare/references/*.md; do
  # Extract unique tag names (excluding HTML)
  tags=$(grep -oP '^<([a-z_][a-z_0-9]*)>$' "$f" | sed 's/<//;s/>//' | sort -u)
  for tag in $tags; do
    case "$tag" in head|html|style|nav|template|div|button|script|article|a|p|span|form|input|label|select|option|ul|li|ol|table|tr|td|th|img|br|hr|link|meta|body|footer|header|main|section) continue ;; esac
    o=$(grep -c "^<${tag}>$" "$f")
    c=$(grep -c "^</${tag}>$" "$f")
    if [ "$o" -ne "$c" ]; then echo "UNBALANCED: $(basename $f) <$tag> open=$o close=$c"; fi
  done
done
```

3b. Nesting depth check. For each file, track depth as you encounter opening/closing tags (excluding HTML). Max depth must be <= 1:
```bash
for f in .claude/skills/astro-cloudflare/references/*.md; do
  depth=0; max_depth=0
  while IFS= read -r line; do
    if echo "$line" | grep -qP "^<([a-z_][a-z_0-9]*)>$"; then
      tag=$(echo "$line" | sed 's/<//;s/>//')
      case "$tag" in head|html|style|nav|template|div|button|script|article|a) continue ;; esac
      depth=$((depth + 1))
      [ $depth -gt $max_depth ] && max_depth=$depth
    elif echo "$line" | grep -qP "^</([a-z_][a-z_0-9]*)>$"; then
      tag=$(echo "$line" | sed 's/<\///;s/>//')
      case "$tag" in head|html|style|nav|template|div|button|script|article|a) continue ;; esac
      depth=$((depth - 1))
    fi
  done < "$f"
  echo "$(basename $f): max_depth=$max_depth $([ $max_depth -le 1 ] && echo PASS || echo FAIL)"
done
```

3c. snake_case validation -- verify every tag name matches `^[a-z][a-z_0-9]*$`:
```bash
for f in .claude/skills/astro-cloudflare/references/*.md; do
  grep -oP '^<([a-z_][a-z_0-9]*)>$' "$f" | sed 's/<//;s/>//' | sort -u | while read tag; do
    case "$tag" in head|html|style|nav|template|div|button|script|article|a) continue ;; esac
    if ! echo "$tag" | grep -qP '^[a-z][a-z_0-9]*$'; then
      echo "INVALID snake_case: $tag in $(basename $f)"
    fi
  done
done
```

**Check 4: Aggregate token overhead**

Use pre-recorded baselines from phases 12-14 (see RESEARCH.md baseline data registry). Measure current byte count with `wc -c`. Calculate per-file and aggregate overhead. Aggregate must be below 5%.

Baselines (bytes):
- cloudflare-platform.md: 9002
- rendering-modes.md: 9230
- components-islands.md: 12044
- seo-i18n.md: 11005
- typescript-testing.md: 12725
- project-structure.md: 9239
- build-deploy.md: 13408
- routing-navigation.md: 11922
- data-content.md: 11559
- styling-performance.md: 11673
- security-advanced.md: 13272
- TOTAL baseline: 125079

Capture ALL output from every check for use in Task 2.
  </action>
  <verify>
All 4 checks produce results:
- Check 1: "Result: 102 / 102"
- Check 2: Universal tags each show "11/11 files", shared tags match expected list
- Check 3: No UNBALANCED, no FAIL in nesting, no INVALID snake_case
- Check 4: Aggregate overhead percentage is below 5.00%
  </verify>
  <done>All 4 validation checks executed with zero failures. Complete output captured for VERIFICATION.md.</done>
</task>

<task type="auto">
  <name>Task 2: Create VERIFICATION.md documenting all results</name>
  <files>.planning/phases/15-final-validation/15-final-validation-VERIFICATION.md</files>
  <action>
Create the formal verification document at `.planning/phases/15-final-validation/15-final-validation-VERIFICATION.md` using the output from Task 1.

Structure:

```markdown
# Phase 15: Final Validation - Verification

**Date:** 2026-02-04
**Phase:** 15-final-validation
**Verifier:** Claude (automated)

## Summary

[1-2 sentence result: all checks pass / failures found]

## Check 1: 102 Grep Patterns (VAL-01 + VAL-03)

**Result:** [PASS/FAIL] -- [N]/102 patterns match

[Paste output. If all pass, summarize. If any fail, list each failure.]

### Distribution by File

[Table showing per-file pattern count and result]

## Check 2: Tag Vocabulary Consistency (VAL-02)

**Result:** [PASS/FAIL]

### Universal Tags

| Tag | Files Found | Expected | Status |
|-----|:-----------:|:--------:|--------|
| quick_reference | N/11 | 11 | PASS/FAIL |
| anti_patterns | N/11 | 11 | PASS/FAIL |
| troubleshooting | N/11 | 11 | PASS/FAIL |

### Shared Domain Tags

| Tag | Files | Semantic Match | Status |
|-----|-------|:--------------:|--------|
| config_templates | [list] | YES/NO | PASS/FAIL |

### Naming Drift Check

[Any tags appearing in >1 file besides universal + config_templates]

## Check 3: Tag Well-Formedness

**Result:** [PASS/FAIL]

### Balanced Tags

| File | Open | Close | Status |
|------|:----:|:-----:|--------|
[Per-file results]

### Nesting Depth

| File | Max Depth | Status |
|------|:---------:|--------|
[Per-file results -- all should be 1]

### snake_case Validation

[Result -- all tag names valid or list invalids]

## Check 4: Aggregate Token Overhead

**Result:** [PASS/FAIL] -- [X.XX]% aggregate (threshold: 5.00%)

| File | Baseline | Current | Overhead |
|------|:--------:|:-------:|:--------:|
[Per-file table]
| **AGGREGATE** | **125,079** | **N** | **X.XX%** |

## Success Criteria Mapping

| # | Criterion | Result | Evidence |
|---|-----------|:------:|----------|
| 1 | 102/102 grep patterns pass | PASS/FAIL | Check 1 |
| 2 | Tag vocabulary consistent | PASS/FAIL | Check 2 |
| 3 | Tags well-formed (balanced, flat, snake_case) | PASS/FAIL | Check 3 |
| 4 | Aggregate overhead < 5% | PASS/FAIL | Check 4 |

## Conclusion

[Final statement: Phase 15 PASSED/FAILED. v0.3 is complete/needs fixes.]
```

Fill in all placeholders with actual data from Task 1. Every number must come from the validation output, not from estimates.
  </action>
  <verify>
- File exists at `.planning/phases/15-final-validation/15-final-validation-VERIFICATION.md`
- All 4 check sections have actual data (no placeholders remaining)
- Summary conclusion states overall PASS or FAIL
- Success criteria mapping table has 4 rows with results
  </verify>
  <done>VERIFICATION.md exists with all 4 checks documented, all using actual validation data, with clear PASS/FAIL per criterion and overall conclusion.</done>
</task>

</tasks>

<verification>
After both tasks complete:
1. `grep "102 / 102\|102/102" .planning/phases/15-final-validation/15-final-validation-VERIFICATION.md` returns a match
2. `grep "AGGREGATE" .planning/phases/15-final-validation/15-final-validation-VERIFICATION.md` returns a match with overhead < 5%
3. `grep "ALL CHECKS PASSED\|Phase 15 PASSED\|v0.3 is complete" .planning/phases/15-final-validation/15-final-validation-VERIFICATION.md` returns a match
4. No "[PLACEHOLDER]" or "[TBD]" text remains in the verification document
</verification>

<success_criteria>
- VERIFICATION.md created with all 4 success criteria documented
- 102/102 grep patterns confirmed PASS
- Tag vocabulary confirmed consistent (3 universal in all 11, config_templates in 2 with matching semantics)
- Tag well-formedness confirmed (balanced, flat, snake_case)
- Aggregate overhead confirmed below 5%
- Zero regressions across the entire v0.3 restructuring
</success_criteria>

<output>
After completion, create `.planning/phases/15-final-validation/15-01-SUMMARY.md`
</output>
