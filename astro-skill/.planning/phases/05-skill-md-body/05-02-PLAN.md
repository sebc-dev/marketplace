---
phase: 05-skill-md-body
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - .claude/skills/astro-cloudflare/SKILL.md
autonomous: true

must_haves:
  truths:
    - "SKILL.md contains grep hints for all 11 reference files"
    - "Every grep pattern returns 1-5 lines when run against its target file"
    - "SKILL.md contains a troubleshooting quick-index routing symptoms to reference files"
    - "SKILL.md total body (excluding frontmatter) is under 500 lines"
  artifacts:
    - path: ".claude/skills/astro-cloudflare/SKILL.md"
      provides: "Complete navigation hub with grep hints and troubleshooting index"
      contains: "## Reference Navigation"
  key_links:
    - from: "SKILL.md Reference Navigation"
      to: "references/*.md"
      via: "grep -n patterns targeting H2/H3 headings"
      pattern: "grep -n"
    - from: "SKILL.md Quick Troubleshooting Index"
      to: "references/*.md"
      via: "Symptom-to-file routing table"
      pattern: "references/.*\\.md"
---

<objective>
Write the second half of the SKILL.md body: Reference Navigation section with grep hints for all 11 reference files, and a Quick Troubleshooting Index.

Purpose: These sections enable Claude to navigate from SKILL.md to the exact section in any reference file without reading entire files. This is the core progressive disclosure mechanism.
Output: SKILL.md body completed with ~250 additional lines appended after Plan 01's content, bringing total body to ~400-480 lines.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-skill-md-body/05-RESEARCH.md
@.planning/phases/05-skill-md-body/05-01-SUMMARY.md

@.claude/skills/astro-cloudflare/SKILL.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Write Reference Navigation with verified grep hints</name>
  <files>.claude/skills/astro-cloudflare/SKILL.md</files>
  <action>
Append a `## Reference Navigation` section to SKILL.md after the existing MCP Integration section.

For each of the 11 reference files, write a subsection with this structure:
```
### filename.md
One-line description of what the file covers.
- Topic A: `grep -n "H2 or H3 heading" references/filename.md`
- Topic B: `grep -n "H2 or H3 heading" references/filename.md`
- Topic C: `grep -n "H2 or H3 heading" references/filename.md`
- Anti-patterns: `grep -n "Anti-patterns" references/filename.md`
- Troubleshooting: `grep -n "Troubleshooting" references/filename.md`
```

**CRITICAL: Every grep pattern must target an actual H2 (`## `) or H3 (`### `) heading that exists in the file.** Before writing, read each reference file's headings. Here are the verified headings to use (from actual files):

1. **project-structure.md** -- File organization, naming conventions, config templates (astro.config, tsconfig, env.d.ts, content.config).
   - File organization: `grep -n "File Organization" references/project-structure.md`
   - Naming conventions: `grep -n "Naming Conventions" references/project-structure.md`
   - Config templates: `grep -n "Config Templates" references/project-structure.md`

2. **rendering-modes.md** -- Output modes, SSG/SSR decision matrix, Server Islands, feature compatibility.
   - Output modes: `grep -n "Output Modes" references/rendering-modes.md`
   - Decision matrix: `grep -n "Decision Matrix" references/rendering-modes.md`
   - Server Islands: `grep -n "Server Islands" references/rendering-modes.md`
   - Feature compatibility: `grep -n "Feature Compatibility" references/rendering-modes.md`

3. **cloudflare-platform.md** -- Bindings (KV/D1/R2), Workers limits, Node.js compat, env vars, wrangler config.
   - Bindings access: `grep -n "Bindings Access" references/cloudflare-platform.md`
   - Workers limits: `grep -n "Workers Limits" references/cloudflare-platform.md`
   - Node.js compatibility: `grep -n "Node.js Compatibility" references/cloudflare-platform.md`
   - Environment variables: `grep -n "Environment Variables" references/cloudflare-platform.md`

4. **components-islands.md** -- Hydration directives, Server Islands, nanostores, slots, component typing.
   - Hydration decision: `grep -n "Hydration Directive Decision" references/components-islands.md`
   - Island vs Static vs Server: `grep -n "Island vs Static" references/components-islands.md`
   - Nanostores: `grep -n "Nanostores Pattern" references/components-islands.md`
   - Server Island pattern: `grep -n "Server Island Pattern" references/components-islands.md`

5. **routing-navigation.md** -- File routing, dynamic routes, redirects, middleware, ClientRouter.
   - Routing strategy: `grep -n "Routing Strategy" references/routing-navigation.md`
   - Redirect methods: `grep -n "Redirect Method" references/routing-navigation.md`
   - Middleware: `grep -n "Middleware Pattern" references/routing-navigation.md`
   - ClientRouter: `grep -n "ClientRouter" references/routing-navigation.md`

6. **data-content.md** -- Content Layer, loaders, collections, Actions, MDX/Markdoc.
   - Loader selection: `grep -n "Loader Selection" references/data-content.md`
   - Actions vs API: `grep -n "Actions vs API" references/data-content.md`
   - Content config: `grep -n "Content Layer Config" references/data-content.md`
   - MDX vs Markdoc: `grep -n "MDX / Markdoc" references/data-content.md`

7. **styling-performance.md** -- Images, scoped styles, Tailwind v4, caching, prefetch.
   - Image service: `grep -n "Image Service" references/styling-performance.md`
   - Scoped styles: `grep -n "Scoped Style" references/styling-performance.md`
   - Tailwind v4: `grep -n "Tailwind v4" references/styling-performance.md`
   - Caching strategy: `grep -n "Caching Strategy" references/styling-performance.md`

8. **seo-i18n.md** -- Meta tags, sitemap, OpenGraph, JSON-LD, i18n, hreflang.
   - SEO component: `grep -n "SEO Component" references/seo-i18n.md`
   - Sitemap: `grep -n "Sitemap Config" references/seo-i18n.md`
   - i18n config: `grep -n "i18n Config" references/seo-i18n.md`
   - Translation decision: `grep -n "Translation Decision" references/seo-i18n.md`

9. **typescript-testing.md** -- TypeScript config, env.d.ts, Vitest, Container API, Playwright.
   - TypeScript config: `grep -n "TypeScript Config" references/typescript-testing.md`
   - env.d.ts: `grep -n "env.d.ts" references/typescript-testing.md`
   - Test type decision: `grep -n "Test Type Decision" references/typescript-testing.md`
   - Container API: `grep -n "Container API" references/typescript-testing.md`

10. **build-deploy.md** -- Dev/preview workflow, deployment, CI/CD, debugging, VS Code.
    - Output mode decision: `grep -n "Output Mode Decision" references/build-deploy.md`
    - Deployment target: `grep -n "Deployment Target" references/build-deploy.md`
    - CI/CD: `grep -n "GitHub Actions" references/build-deploy.md`
    - Debugging: `grep -n "Debugging Workflow" references/build-deploy.md`

11. **security-advanced.md** -- CSP, auth middleware, Actions security, secrets, MDX/Markdoc advanced.
    - Security headers: `grep -n "Security Headers" references/security-advanced.md`
    - Auth middleware: `grep -n "Auth Middleware" references/security-advanced.md`
    - Actions security: `grep -n "Actions Security" references/security-advanced.md`
    - MDX/Markdoc advanced: `grep -n "MDX/Markdoc Advanced" references/security-advanced.md`

**For every file**, also include the Anti-patterns and Troubleshooting grep lines:
- Anti-patterns: `grep -n "Anti-patterns" references/filename.md`
- Troubleshooting: `grep -n "Troubleshooting" references/filename.md`

Budget: ~200 lines for this section (11 files x ~18 lines each = ~198).

**After writing, verify EVERY grep pattern actually matches by running all patterns.** If a pattern returns 0 matches, fix the heading text to match the actual heading in the file. This is critical -- broken grep hints defeat the entire purpose of the navigation hub.
  </action>
  <verify>
1. Run every grep pattern from the Reference Navigation section against its target file and confirm each returns 1-5 lines (not 0, not 50+)
2. Count the number of `### ` subsections under `## Reference Navigation` -- should be 11 (one per file)
3. Run `grep -c "grep -n" .claude/skills/astro-cloudflare/SKILL.md` -- should be 60+ (at least 5-6 per file x 11 files)
  </verify>
  <done>
All 11 reference files have navigation entries with verified grep patterns. Every pattern returns 1-5 lines when run against its target file.
  </done>
</task>

<task type="auto">
  <name>Task 2: Write Quick Troubleshooting Index and validate line count</name>
  <files>.claude/skills/astro-cloudflare/SKILL.md</files>
  <action>
Append a `## Quick Troubleshooting Index` section after the Reference Navigation section.

Write a compact 2-column table routing common error symptoms to the right reference file:

| Symptom | Reference |
|---------|-----------|
| "Cannot find module" / import errors | [typescript-testing.md](references/typescript-testing.md) |
| Build fails on Cloudflare | [build-deploy.md](references/build-deploy.md) |
| `process.env` undefined | [cloudflare-platform.md](references/cloudflare-platform.md) |
| Image processing errors / Sharp | [styling-performance.md](references/styling-performance.md) |
| Hydration mismatch | [components-islands.md](references/components-islands.md) |
| Content collection errors | [data-content.md](references/data-content.md) |
| 404 on dynamic routes | [routing-navigation.md](references/routing-navigation.md) |
| CSP / security header issues | [security-advanced.md](references/security-advanced.md) |
| Sitemap / SEO missing | [seo-i18n.md](references/seo-i18n.md) |
| Server Island not rendering | [components-islands.md](references/components-islands.md) + [rendering-modes.md](references/rendering-modes.md) |
| Binding not available in dev | [cloudflare-platform.md](references/cloudflare-platform.md) |
| ViewTransitions errors | Critical Rules #5 above + [routing-navigation.md](references/routing-navigation.md) |

Budget: ~20 lines for this section (compact table).

**Final validation after writing:**
1. Count total lines in SKILL.md: `wc -l .claude/skills/astro-cloudflare/SKILL.md`
2. The body (everything after line 19) must be under 500 lines
3. If over 480 lines, trim the least valuable grep hints (keep 4 per file minimum: 2 domain-specific + anti-patterns + troubleshooting)
4. If under 400 lines, the budget is fine -- do not pad

Target: 400-480 total body lines (419-499 total file lines including 19-line frontmatter).
  </action>
  <verify>
1. Run `wc -l .claude/skills/astro-cloudflare/SKILL.md` -- total should be under 499 lines (19 frontmatter + <480 body)
2. Run `grep -c "^## " .claude/skills/astro-cloudflare/SKILL.md` -- should return 5 (Critical Rules, Decision Matrices, MCP Integration, Reference Navigation, Quick Troubleshooting Index)
3. Confirm body line count: `tail -n +20 .claude/skills/astro-cloudflare/SKILL.md | wc -l` -- should be under 500
4. Run `grep -c "references/" .claude/skills/astro-cloudflare/SKILL.md` -- should be 50+ (many cross-references)
  </verify>
  <done>
SKILL.md body is complete with 5 sections totaling under 500 lines. All 11 reference files have grep navigation entries. Troubleshooting index routes 12 common symptoms to the right reference file. Requirements STRUCT-02 and STRUCT-05 are fully satisfied.
  </done>
</task>

</tasks>

<verification>
- `wc -l .claude/skills/astro-cloudflare/SKILL.md` returns under 499 (19 frontmatter + <480 body)
- `tail -n +20 .claude/skills/astro-cloudflare/SKILL.md | wc -l` returns under 500
- `grep -c "^## " .claude/skills/astro-cloudflare/SKILL.md` returns 5
- All grep patterns in Reference Navigation section return 1-5 lines when executed
- 11 reference files each have a `### filename.md` subsection in Reference Navigation
- Troubleshooting Index has 10+ symptom-to-file routing rows
</verification>

<success_criteria>
- Requirement STRUCT-02 (SKILL.md body <500 lines, navigation hub): COMPLETE
- Requirement STRUCT-05 (grep hints for every reference file): COMPLETE
- All 6 Phase 5 requirements (STRUCT-02, STRUCT-05, CROSS-01, CROSS-02, INTEG-01, INTEG-02) are satisfied across Plan 01 + Plan 02
- SKILL.md body functions as complete navigation hub: rules -> decisions -> navigation -> troubleshooting
</success_criteria>

<output>
After completion, create `.planning/phases/05-skill-md-body/05-02-SUMMARY.md`
</output>
