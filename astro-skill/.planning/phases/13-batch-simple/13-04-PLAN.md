---
phase: 13-batch-simple
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - .claude/skills/astro-cloudflare/references/typescript-testing.md
autonomous: true

must_haves:
  truths:
    - "typescript-testing.md has 11 XML containers wrapping every ## section"
    - "Universal tags quick_reference, anti_patterns, troubleshooting are named identically to the pilot"
    - "All 10 grep patterns for typescript-testing.md in SKILL.md return exactly 1 match"
    - "git diff shows only added XML tag lines -- zero content modifications"
    - "Token overhead is below 5%"
    - "2 MCP callouts are preserved inside their parent containers"
  artifacts:
    - path: ".claude/skills/astro-cloudflare/references/typescript-testing.md"
      provides: "XML-tagged TypeScript and testing reference"
      contains: "<quick_reference>"
  key_links:
    - from: ".claude/skills/astro-cloudflare/SKILL.md"
      to: "references/typescript-testing.md"
      via: "grep patterns"
      pattern: "grep -n .* references/typescript-testing.md"
---

<objective>
Apply XML semantic containers to typescript-testing.md (11 sections, no subsections, 2 MCP callouts to preserve inside parent tags).

Purpose: Fourth file in the batch, validates MCP callout preservation inside containers.
Output: typescript-testing.md with 11 XML tags wrapping all ## sections, committed after validation.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/XML-CONVENTIONS.md
@.claude/skills/astro-cloudflare/references/cloudflare-platform.md (pilot reference -- also has MCP callouts)
@.claude/skills/astro-cloudflare/references/typescript-testing.md
@.claude/skills/astro-cloudflare/SKILL.md (grep patterns)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Record baseline and apply 11 XML tags to typescript-testing.md</name>
  <files>.claude/skills/astro-cloudflare/references/typescript-testing.md</files>
  <action>
1. Record baseline: `wc -c .claude/skills/astro-cloudflare/references/typescript-testing.md`

2. Add XML container tags around each ## section. Tag map (11 tags):

| Line | Header | Tag | Note |
|------|--------|-----|------|
| 5 | `## Quick Reference` | `<quick_reference>` | Universal |
| 22 | `## TypeScript Config Decision Matrix` | `<typescript_config>` | Shortened: drop format terms |
| 37 | `## env.d.ts Full Pattern` | `<env_types>` | Shortened: semantic content descriptor |
| 72 | `## Test Type Decision Matrix` | `<test_types>` | Shortened: drop format terms |
| 87 | `## Vitest Config` | `<vitest_config>` | Direct derivation |
| 110 | `## Container API Test` | `<container_api>` | Shortened: drop "Test" |
| 165 | `## Cloudflare Bindings Test` | `<bindings_test>` | Shortened: drop "Cloudflare" (implicit) |
| 209 | `## Playwright Config` | `<playwright_config>` | Direct derivation |
| 237 | `## Package Scripts` | `<package_scripts>` | Direct derivation |
| 253 | `## Anti-patterns` | `<anti_patterns>` | Universal |
| 268 | `## Troubleshooting` | `<troubleshooting>` | Universal |

IMPORTANT: Line 3 has a subtitle. It stays OUTSIDE all tags.

MCP CALLOUTS (must stay inside parent tags):
- ~Line 70: `> **Cloudflare MCP:** ...` stays inside `<env_types>` (its parent ## section)
- ~Line 207: `> **Cloudflare MCP:** ...` stays inside `<bindings_test>` (its parent ## section)

Rules (from XML-CONVENTIONS.md):
- Opening tag goes immediately BEFORE the `##` header (no blank line between tag and header)
- Closing tag goes immediately AFTER the last content line of the section (no blank line before closing tag)
- Blank lines BETWEEN sections are preserved
- File title and subtitle stay outside all tags
- MCP callouts (blockquotes starting with `>`) stay inside their parent container
- DO NOT modify any content -- only add XML tag lines

3. Validate all 4 checks:

Check 1 -- Grep patterns (10 patterns, all must return exactly 1 match):
```bash
cd .claude/skills/astro-cloudflare
grep -n "## TypeScript Config Decision Matrix" references/typescript-testing.md | wc -l  # expect 1
grep -n "## env.d.ts Full Pattern" references/typescript-testing.md | wc -l               # expect 1
grep -n "## Test Type Decision Matrix" references/typescript-testing.md | wc -l            # expect 1
grep -n "## Vitest Config" references/typescript-testing.md | wc -l                        # expect 1
grep -n "## Container API Test" references/typescript-testing.md | wc -l                   # expect 1
grep -n "## Cloudflare Bindings Test" references/typescript-testing.md | wc -l             # expect 1
grep -n "## Playwright Config" references/typescript-testing.md | wc -l                    # expect 1
grep -n "## Package Scripts" references/typescript-testing.md | wc -l                      # expect 1
grep -n "## Anti-patterns" references/typescript-testing.md | wc -l                        # expect 1
grep -n "## Troubleshooting" references/typescript-testing.md | wc -l                      # expect 1
```

Check 2 -- Diff integrity:
```bash
git diff .claude/skills/astro-cloudflare/references/typescript-testing.md | grep '^+' | grep -v '^+++' | grep -v '^+$' | grep -v '^+</?[a-z_]*>$'
# Must return empty
```

Check 3 -- Overhead:
```bash
wc -c .claude/skills/astro-cloudflare/references/typescript-testing.md
# Calculate: (after - before) / before * 100, must be < 5%
```

Check 4 -- Tag balance:
```bash
grep -c '^<[a-z_]*>$' .claude/skills/astro-cloudflare/references/typescript-testing.md   # expect 11
grep -c '^</[a-z_]*>$' .claude/skills/astro-cloudflare/references/typescript-testing.md  # expect 11
```

4. If all checks pass, commit:
```bash
git add .claude/skills/astro-cloudflare/references/typescript-testing.md
git commit -m "feat(13-04): apply XML semantic containers to typescript-testing.md"
```
  </action>
  <verify>All 4 validation checks pass (grep patterns, diff integrity, overhead < 5%, tag balance 11/11). Commit created.</verify>
  <done>typescript-testing.md has 11 XML containers, 2 MCP callouts preserved inside parent tags, zero content changes, overhead < 5%, all grep patterns return 1 match, committed.</done>
</task>

</tasks>

<verification>
1. `grep -c '^<[a-z_]*>$' .claude/skills/astro-cloudflare/references/typescript-testing.md` returns 11
2. `grep -c '^</[a-z_]*>$' .claude/skills/astro-cloudflare/references/typescript-testing.md` returns 11
3. All 10 SKILL.md grep patterns for typescript-testing.md return exactly 1 match each
4. `git diff HEAD~1 -- .claude/skills/astro-cloudflare/references/typescript-testing.md | grep '^+' | grep -v '^+++' | grep -v '^+$' | grep -v '^+</?[a-z_]*>$'` returns empty
5. Overhead < 5%
6. MCP callouts verified inside their parent tags (not outside or lost)
</verification>

<success_criteria>
typescript-testing.md contains 11 XML semantic containers wrapping every ## section, MCP callouts preserved inside parent tags, with zero content modifications and all SKILL.md grep patterns returning exactly 1 match.
</success_criteria>

<output>
After completion, create `.planning/phases/13-batch-simple/13-04-SUMMARY.md`
</output>
