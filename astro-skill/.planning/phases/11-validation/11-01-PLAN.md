---
phase: 11-validation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .planning/phases/11-validation/routing-validation.md
  - .planning/phases/11-validation/regression-check.md
  - .planning/phases/11-validation/mcp-fixtures.md
  - .planning/STATE.md
  - .planning/ROADMAP.md
  - .planning/REQUIREMENTS.md
autonomous: true

must_haves:
  truths:
    - "5 routing scenarios (pure Astro, pure Cloudflare, intersection, out of scope, ambiguous) each trace to the correct source via SKILL.md routing table"
    - "3 high-risk E2E MCP calls return relevant Cloudflare documentation confirming routing correctness"
    - "All 10 MCP callouts across 4 reference files use consistent blockquote format with tool name and hybrid query"
    - "All grep patterns from SKILL.md Reference Navigation (lines 128-266) match their target headings in all 11 reference files"
    - "7 unmodified reference files are byte-identical to v0.1 commit 549eb84"
    - "Astro MCP search_astro_docs sections are unchanged from v0.1"
    - "v0.2 milestone is finalized in STATE.md, ROADMAP.md, and REQUIREMENTS.md"
  artifacts:
    - path: ".planning/phases/11-validation/routing-validation.md"
      provides: "5-scenario routing matrix + E2E MCP results + callout cross-check"
      contains: "PASS"
    - path: ".planning/phases/11-validation/regression-check.md"
      provides: "Grep pattern scan + git diff verification + SKILL.md line count"
      contains: "PASS"
    - path: ".planning/phases/11-validation/mcp-fixtures.md"
      provides: "Full MCP response text for 3 high-risk queries as regression fixtures"
      contains: "mcp__cloudflare__search_cloudflare_documentation"
  key_links:
    - from: "SKILL.md routing table (lines 84-95)"
      to: "routing-validation.md scenarios"
      via: "each routing table row exercised by at least one scenario"
      pattern: "Row \\d+"
    - from: "SKILL.md Reference Navigation (lines 128-266)"
      to: "regression-check.md grep results"
      via: "every grep pattern extracted and verified against target file"
      pattern: "grep -n"
    - from: "routing-validation.md E2E results"
      to: "mcp-fixtures.md fixture storage"
      via: "each E2E MCP response stored in full as fixture"
      pattern: "Fixture"
---

<objective>
Validate all v0.2 changes (Phases 8-10) work correctly together, confirm v0.1 functionality is preserved, and finalize the v0.2 milestone.

Purpose: This is the final gate before shipping v0.2. It provides definitive proof that routing works, formats are consistent, nothing regressed, and the milestone is complete.
Output: 3 validation report files (routing-validation.md, regression-check.md, mcp-fixtures.md) + updated planning docs (STATE.md, ROADMAP.md, REQUIREMENTS.md)
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@.planning/phases/11-validation/11-CONTEXT.md
@.planning/phases/11-validation/11-RESEARCH.md
@.planning/phases/10-reference-file-integration/10-01-SUMMARY.md
@.claude/skills/astro-cloudflare/SKILL.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Routing validation + E2E MCP calls + callout format check</name>
  <files>
    .planning/phases/11-validation/routing-validation.md
    .planning/phases/11-validation/mcp-fixtures.md
  </files>
  <action>
    Produce two report files: routing-validation.md and mcp-fixtures.md.

    **Part A: Documentary routing verification (5 scenarios)**

    Read SKILL.md routing table (lines 84-95). For each of the 5 routing categories, trace through the table to determine correct source:

    1. Pure Astro: "What are the options for defineAction?" -> Expected: Astro MCP (Row 2)
    2. Pure Cloudflare: "What are the KV put expiration options?" -> Expected: Cloudflare MCP (Row 4)
    3. Intersection: "How do I access KV bindings in an Astro component?" -> Expected: Skill references (Row 7)
    4. Out of scope: "How do I configure Cloudflare Zero Trust?" -> Expected: Out of scope (SKILL.md exclusions)
    5. Ambiguous: "My Worker is throwing errors" -> Expected: Skill references first, then MCP fallback (Row 8)

    For each scenario, document: query, expected source, routing table row match, actual source (from table analysis), verdict (PASS/FAIL), notes. Use the exact table format from RESEARCH.md "Routing Validation Matrix Pattern."

    **Part B: E2E MCP calls (3 high-risk cases)**

    Execute exactly 3 MCP calls using `mcp__cloudflare__search_cloudflare_documentation` for the "one-way door" cases where incorrect routing breaks code:

    1. KV binding method signature: query "Workers KV namespace put get delete API method parameters"
    2. D1 prepare/bind syntax: query "Cloudflare D1 database prepare bind SQL API"
    3. Workers compatibility flags: query "Workers compatibility flags nodejs_compat compatibility date"

    For each E2E test, document in routing-validation.md: risk description, query sent, response summary, relevant result count, gaps covered by skill, verdict.

    Store the FULL MCP response text (not just summary) in mcp-fixtures.md. Each fixture must document both what the tool returns AND what it does NOT return (gaps the skill references cover). Use the fixture format from RESEARCH.md.

    **Part C: Callout format consistency cross-check**

    Verify all 10 MCP callouts across the 4 reference files:
    - Each uses blockquote prefix `> **Cloudflare MCP:**`
    - Each includes full tool name `mcp__cloudflare__search_cloudflare_documentation`
    - Each query string follows hybrid pattern (product name + specific action, 5+ words)
    - No SKILL.md caveats (empty titles, doubled URLs) leaked into reference file callouts

    Use grep commands from RESEARCH.md Example 5. Count callouts per file: cloudflare-platform.md=4, build-deploy.md=3, security-advanced.md=1, typescript-testing.md=2 (total=10).

    Cross-reference: for each Cloudflare MCP row in the routing table, verify at least one callout exists in the relevant reference file.

    Add callout results to routing-validation.md as a "Format Consistency" section.

    **Report structure for routing-validation.md:**
    - Summary matrix table at top (all 5 scenarios + 3 E2E tests + format check, with status)
    - Detailed sections below for each test
    - Final verdict: ALL PASS or list failures

    **Do NOT stop at first failure.** Run all tests, report all results.
  </action>
  <verify>
    1. routing-validation.md exists with summary matrix at top
    2. All 5 routing scenarios documented with verdict
    3. All 3 E2E MCP responses recorded
    4. mcp-fixtures.md contains full response text for 3 queries
    5. Callout count verification: grep -c "Cloudflare MCP" across 4 files matches 4+3+1+2=10
    6. No FAIL verdicts (zero tolerance per CONTEXT.md)
  </verify>
  <done>5 routing scenarios PASS, 3 E2E tests PASS, 10 callouts verified consistent, mcp-fixtures.md contains full fixture data</done>
</task>

<task type="auto">
  <name>Task 2: v0.1 regression check</name>
  <files>
    .planning/phases/11-validation/regression-check.md
  </files>
  <action>
    Produce regression-check.md with 4 verification sections.

    **Part A: Grep pattern scan (ALL 11 reference files)**

    Extract all grep patterns from SKILL.md Reference Navigation section (lines 128-266). Use:
    ```
    grep -oP '(?<=grep -n ")[^"]+' .claude/skills/astro-cloudflare/SKILL.md
    ```
    Count patterns per file with:
    ```
    grep -oP 'references/\S+\.md' .claude/skills/astro-cloudflare/SKILL.md | sort | uniq -c
    ```

    For EACH extracted pattern, run the actual grep command against its target reference file and confirm the heading is found at a valid line number. Document in a table per reference file: pattern, expected result, actual result (line number), status (PASS/FAIL).

    This is a FULL scan of ALL 11 reference files, not just the 4 modified by v0.2.

    **Part B: Unmodified file identity check (7 files)**

    Verify the 7 reference files NOT touched by v0.2 are byte-identical to v0.1 commit 549eb84:
    ```
    git diff 549eb84..HEAD -- \
      .claude/skills/astro-cloudflare/references/project-structure.md \
      .claude/skills/astro-cloudflare/references/rendering-modes.md \
      .claude/skills/astro-cloudflare/references/components-islands.md \
      .claude/skills/astro-cloudflare/references/data-content.md \
      .claude/skills/astro-cloudflare/references/routing-navigation.md \
      .claude/skills/astro-cloudflare/references/styling-performance.md \
      .claude/skills/astro-cloudflare/references/seo-i18n.md
    ```
    Expected: empty output (zero changes). Document result.

    **Part C: Astro MCP non-regression**

    Verify Astro MCP integration is unchanged from v0.1 via git diff -- NOT by functional MCP call (per CONTEXT.md):
    ```
    git show 549eb84:.claude/skills/astro-cloudflare/SKILL.md | grep -A5 "Use MCP when you need"
    ```
    Compare with current:
    ```
    grep -A5 "Use MCP when you need" .claude/skills/astro-cloudflare/SKILL.md
    ```
    Both outputs must be identical. Also verify `search_astro_docs` references are unchanged:
    ```
    git diff 549eb84..HEAD -- .claude/skills/astro-cloudflare/SKILL.md | grep "search_astro_docs"
    ```
    Expected: no lines removed (only additions around the section, if any).

    **Part D: SKILL.md line count metric**

    Report the final SKILL.md body line count as a milestone metric. Verify body is at 266 lines with 14-line margin to 280 hard limit. This confirms the v0.2 line budget was maintained.

    **Report structure for regression-check.md:**
    - Summary matrix table at top (pattern scan totals, file identity results, Astro MCP status, line count)
    - Detailed sections below for each check
    - Final verdict: ALL PASS or list failures

    **Do NOT stop at first failure.** Run all checks, report all results.
  </action>
  <verify>
    1. regression-check.md exists with summary matrix at top
    2. All grep patterns from SKILL.md Reference Navigation verified (count matches extracted total)
    3. 7 unmodified files confirmed byte-identical to 549eb84
    4. Astro MCP content confirmed unchanged
    5. SKILL.md line count documented
    6. No FAIL verdicts
  </verify>
  <done>All grep patterns match, 7 untouched files identical to v0.1, Astro MCP sections unchanged, SKILL.md at 266 body lines with 14-line margin</done>
</task>

<task type="auto">
  <name>Task 3: Milestone finalization</name>
  <files>
    .planning/STATE.md
    .planning/ROADMAP.md
    .planning/REQUIREMENTS.md
  </files>
  <action>
    Update planning docs to finalize v0.2 milestone. Only proceed if Tasks 1 and 2 both show ALL PASS.

    **STATE.md updates:**
    - Current Position: Phase 11 of 11 (Validation) -- COMPLETE
    - Plan: 1 of 1 (phase 11 complete)
    - Status: v0.2 milestone complete
    - Last activity: today's date -- Completed 11-01-PLAN.md (validation + milestone close)
    - Progress: update to 100% with full bar [██████████]
    - v0.2 Velocity: update total plans completed (4), recalculate average duration and total time
    - Session Continuity: Stopped at v0.2 complete, Resume with next milestone planning

    **ROADMAP.md updates:**
    - Mark Phase 11 checkbox as [x] with checkmark
    - Update Plans line for Phase 11: "1 plan" instead of "TBD"
    - Update plan list: "- [x] 11-01-PLAN.md -- Full validation + milestone finalization"
    - Progress table: Phase 11 status = "Complete", Plans = "1/1", Completed = today's date
    - Add v0.2 completion note at top of v0.2 section or in milestone summary

    **REQUIREMENTS.md updates:**
    - Mark VAL-01 as [x] (already complete from Phase 8 but listed as unchecked)
    - Mark VAL-02 as [x]
    - Mark VAL-03 as [x]
    - Update traceability table: VAL-01 = Complete, VAL-02 = Complete, VAL-03 = Complete
    - Update coverage: 13/13 complete
    - Update "Last updated" line

    Commit all validation reports and planning doc updates together.
  </action>
  <verify>
    1. STATE.md shows Phase 11 complete and v0.2 milestone complete
    2. ROADMAP.md shows Phase 11 [x] with "1/1" plans complete
    3. REQUIREMENTS.md shows VAL-01, VAL-02, VAL-03 all [x] and 13/13 coverage
    4. Git commit created with all changes
  </verify>
  <done>v0.2 milestone is finalized: all planning docs updated, all 13 requirements complete, all 4 phases marked done</done>
</task>

</tasks>

<verification>
Phase 11 is complete when:
1. routing-validation.md: 5 routing scenarios PASS + 3 E2E tests PASS + 10 callouts verified
2. regression-check.md: All grep patterns PASS + 7 files identical + Astro MCP unchanged + line count verified
3. mcp-fixtures.md: 3 full MCP responses stored as regression fixtures
4. STATE.md, ROADMAP.md, REQUIREMENTS.md all updated for v0.2 milestone close
5. Zero failures across all tests (zero tolerance per CONTEXT.md)
</verification>

<success_criteria>
- VAL-02 satisfied: 5 routing scenarios each route to correct source (PASS in routing-validation.md)
- VAL-03 satisfied: all grep patterns match, 7 files unchanged, Astro MCP intact (PASS in regression-check.md)
- v0.2 milestone finalized: 13/13 requirements complete, all 4 phases marked done
- 3 MCP fixture files stored for future regression baseline
</success_criteria>

<output>
After completion, create `.planning/phases/11-validation/11-01-SUMMARY.md`
</output>
