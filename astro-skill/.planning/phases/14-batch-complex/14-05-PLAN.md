---
phase: 14-batch-complex
plan: 05
type: execute
wave: 1
depends_on: []
files_modified:
  - .claude/skills/astro-cloudflare/references/security-advanced.md
autonomous: true

must_haves:
  truths:
    - "security-advanced.md has 15 XML containers wrapping every ## section"
    - "Universal tags quick_reference, anti_patterns, troubleshooting are named identically to all prior files"
    - "All 11 grep patterns for security-advanced.md in SKILL.md return exactly 1 match"
    - "git diff shows only added XML tag lines -- zero content modifications"
    - "Token overhead is below 6% (review zone accepted per CONTEXT.md)"
    - "The --- horizontal rule (line ~174) stays outside all tags, between </csp_config> and <mdx_markdoc_advanced_setup>"
    - "The content-less ## MDX/Markdoc Advanced Setup is wrapped in its own tag containing only the header line"
    - "1 MCP callout remains inside its parent tag (secrets_management)"
  artifacts:
    - path: ".claude/skills/astro-cloudflare/references/security-advanced.md"
      provides: "XML-tagged security/advanced reference"
      contains: "<quick_reference>"
  key_links:
    - from: ".claude/skills/astro-cloudflare/SKILL.md"
      to: "references/security-advanced.md"
      via: "grep patterns"
      pattern: "grep -n .* references/security-advanced.md"
---

<objective>
Apply XML semantic containers to security-advanced.md -- 15 sections (most in the batch), 1 MCP callout, 1 horizontal rule divider, 1 content-less section header.

Purpose: Final and most complex file validates structural edge cases: content-less section, horizontal rule placement, and highest tag count.
Output: security-advanced.md with 15 XML tags wrapping all ## sections, committed after validation.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/XML-CONVENTIONS.md
@.planning/phases/14-batch-complex/14-RESEARCH.md
@.claude/skills/astro-cloudflare/references/cloudflare-platform.md (pilot reference)
@.claude/skills/astro-cloudflare/references/security-advanced.md
@.claude/skills/astro-cloudflare/SKILL.md (grep patterns)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Record baseline and apply 15 XML tags to security-advanced.md</name>
  <files>.claude/skills/astro-cloudflare/references/security-advanced.md</files>
  <action>
1. Record baseline: `wc -c .claude/skills/astro-cloudflare/references/security-advanced.md`

2. Add XML container tags around each ## section. Tag map (15 tags):

| Line | Header | Tag |
|------|--------|-----|
| 5 | `## Quick Reference` | `<quick_reference>` |
| 22 | `## Security Decision Matrix` | `<security_decision_matrix>` |
| 30 | `## Security Headers Middleware` | `<security_headers_middleware>` |
| 62 | `## Auth Middleware Pattern` | `<auth_middleware_pattern>` |
| 86 | `## Actions Security Pattern` | `<actions_security_pattern>` |
| 115 | `## Secrets Management` | `<secrets_management>` |
| 148 | `## CSP Config` | `<csp_config>` |
| 176 | `## MDX/Markdoc Advanced Setup` | `<mdx_markdoc_advanced_setup>` |
| 178 | `## Remark/Rehype Plugin Config` | `<remark_rehype_plugin_config>` |
| 210 | `## Custom Component Mapping` | `<custom_component_mapping>` |
| 235 | `## Markdoc Custom Tags` | `<markdoc_custom_tags>` |
| 264 | `## Shiki Dual Theme CSS` | `<shiki_dual_theme_css>` |
| 292 | `## Custom Remark Plugin` | `<custom_remark_plugin>` |
| 313 | `## Anti-patterns` | `<anti_patterns>` |
| 330 | `## Troubleshooting` | `<troubleshooting>` |

**Naming conversions applied per CONTEXT.md:**
- `MDX/Markdoc` -> `mdx_markdoc` (slash becomes underscore)
- `Remark/Rehype` -> `remark_rehype` (slash becomes underscore)

**STRUCTURAL EDGE CASE 1: Content-less `## MDX/Markdoc Advanced Setup` (line ~176)**
This header has NO content body -- it is immediately followed by `## Remark/Rehype Plugin Config` (line ~178). Apply the tag wrapping only the header line:
```markdown
<mdx_markdoc_advanced_setup>
## MDX/Markdoc Advanced Setup
</mdx_markdoc_advanced_setup>

<remark_rehype_plugin_config>
## Remark/Rehype Plugin Config
...
</remark_rehype_plugin_config>
```
The opening and closing tags for `mdx_markdoc_advanced_setup` wrap ONLY the header. The blank line between the two sections stays between the closing `</mdx_markdoc_advanced_setup>` and opening `<remark_rehype_plugin_config>`.

**STRUCTURAL EDGE CASE 2: Horizontal rule `---` (line ~174)**
The `---` separates the security group from the MDX/Markdoc group. It stays OUTSIDE all tags:
```markdown
... last content of CSP Config ...
</csp_config>

---

<mdx_markdoc_advanced_setup>
## MDX/Markdoc Advanced Setup
</mdx_markdoc_advanced_setup>
```
Do NOT include the `---` inside `<csp_config>` or `<mdx_markdoc_advanced_setup>`.

**MCP callout (1 total -- stays inside parent section tag):**
- Line ~146: MCP callout inside `<secrets_management>` -- do NOT split it out

Rules (from XML-CONVENTIONS.md):
- Opening tag goes immediately BEFORE the `##` header (no blank line between tag and header)
- Closing tag goes immediately AFTER the last content line of the section (no blank line before closing tag)
- Blank lines BETWEEN sections are preserved (between closing tag and next opening tag)
- File title and subtitle text get NO tag wrapper
- DO NOT modify any content -- only add XML tag lines

**OVERHEAD NOTE:** Estimated ~5.4% with 15 tags. In the 5.0-6.0% review zone. Per CONTEXT.md: "If the 15 are semantically distinct, 15 tags is legitimate." All 15 sections are distinct -- keep all tags. If actual overhead exceeds 6.0%, shorten the longest tag names.

3. Validate all 4 checks:

Check 1 -- Grep patterns (11 patterns from SKILL.md, all must return exactly 1 match):
```bash
cd .claude/skills/astro-cloudflare
grep -n "## Security Decision Matrix" references/security-advanced.md | wc -l          # expect 1
grep -n "## Security Headers Middleware" references/security-advanced.md | wc -l       # expect 1
grep -n "## Auth Middleware Pattern" references/security-advanced.md | wc -l           # expect 1
grep -n "## Actions Security Pattern" references/security-advanced.md | wc -l         # expect 1
grep -n "## Secrets Management" references/security-advanced.md | wc -l               # expect 1
grep -n "## CSP Config" references/security-advanced.md | wc -l                       # expect 1
grep -n "## MDX/Markdoc Advanced Setup" references/security-advanced.md | wc -l       # expect 1
grep -n "## Remark/Rehype Plugin Config" references/security-advanced.md | wc -l      # expect 1
grep -n "## Custom Component Mapping" references/security-advanced.md | wc -l         # expect 1
grep -n "## Anti-patterns" references/security-advanced.md | wc -l                    # expect 1
grep -n "## Troubleshooting" references/security-advanced.md | wc -l                  # expect 1
```

Check 2 -- Diff integrity (only XML tag lines added):
```bash
git diff .claude/skills/astro-cloudflare/references/security-advanced.md | grep '^+' | grep -v '^+++' | grep -v '^+$' | grep -v '^+</?[a-z_]*>$'
# Must return empty (no non-XML additions)
```

Check 3 -- Overhead:
```bash
wc -c .claude/skills/astro-cloudflare/references/security-advanced.md
# Calculate: (after - before) / before * 100
# Expected ~5.4% (review zone, acceptable if < 6.0%)
```

Check 4 -- Tag balance:
```bash
grep -c '^<[a-z_]*>$' .claude/skills/astro-cloudflare/references/security-advanced.md   # expect 15
grep -c '^</[a-z_]*>$' .claude/skills/astro-cloudflare/references/security-advanced.md  # expect 15
```

Check 5 -- Structural edge cases:
```bash
# Verify --- is NOT inside any tag (should appear between </csp_config> and <mdx_markdoc_advanced_setup>)
grep -n "^---$" .claude/skills/astro-cloudflare/references/security-advanced.md
# Verify mdx_markdoc_advanced_setup wraps only the header (opening and closing on consecutive lines)
grep -n "mdx_markdoc_advanced_setup" .claude/skills/astro-cloudflare/references/security-advanced.md
```

4. If all checks pass, commit:
```bash
git add .claude/skills/astro-cloudflare/references/security-advanced.md
git commit -m "feat(14-05): apply XML semantic containers to security-advanced.md"
```
  </action>
  <verify>All 5 validation checks pass (11 grep patterns each return 1, diff integrity clean, overhead < 6.0%, tag balance 15/15, structural edge cases correct). Commit created.</verify>
  <done>security-advanced.md has 15 XML containers, zero content changes, overhead in review zone (< 6.0%), all 11 grep patterns return 1 match, --- horizontal rule outside tags, content-less MDX/Markdoc header tagged correctly, 1 MCP callout inside parent tag, committed.</done>
</task>

</tasks>

<verification>
1. `grep -c '^<[a-z_]*>$' .claude/skills/astro-cloudflare/references/security-advanced.md` returns 15
2. `grep -c '^</[a-z_]*>$' .claude/skills/astro-cloudflare/references/security-advanced.md` returns 15
3. All 11 SKILL.md grep patterns for security-advanced.md return exactly 1 match each
4. `git diff HEAD~1 -- .claude/skills/astro-cloudflare/references/security-advanced.md | grep '^+' | grep -v '^+++' | grep -v '^+$' | grep -v '^+</?[a-z_]*>$'` returns empty
5. Overhead < 6.0% (review zone accepted -- 15 distinct sections with full-length tag names)
6. `---` horizontal rule appears between `</csp_config>` and `<mdx_markdoc_advanced_setup>`, outside both tags
7. `<mdx_markdoc_advanced_setup>` wraps only the header line (content-less section)
</verification>

<success_criteria>
security-advanced.md contains 15 XML semantic containers wrapping every ## section, with zero content modifications, all SKILL.md grep patterns returning exactly 1 match, horizontal rule outside tags, content-less section tagged correctly, MCP callout preserved inside parent tag, and overhead in the acceptable review zone.
</success_criteria>

<output>
After completion, create `.planning/phases/14-batch-complex/14-05-SUMMARY.md`
</output>
